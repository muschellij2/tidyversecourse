<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 1 Getting Data Into R | 02-get-data.utf8.md</title>
  <meta name="description" content="" />
  <meta name="generator" content="bookdown 0.13.2 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 1 Getting Data Into R | 02-get-data.utf8.md" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 1 Getting Data Into R | 02-get-data.utf8.md" />
  
  
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  


<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Applied Data Science in R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path=""><a href="#get-data"><i class="fa fa-check"></i><b>1</b> Getting Data Into R</a><ul>
<li class="chapter" data-level="1.1" data-path=""><a href="#tibbles"><i class="fa fa-check"></i><b>1.1</b> Tibbles</a><ul>
<li class="chapter" data-level="1.1.1" data-path=""><a href="#how-tibbles-differ-from-data.frame"><i class="fa fa-check"></i><b>1.1.1</b> How tibbles differ from data.frame</a></li>
<li class="chapter" data-level="1.1.2" data-path=""><a href="#creating-a-tibble"><i class="fa fa-check"></i><b>1.1.2</b> Creating a tibble</a></li>
<li class="chapter" data-level="1.1.3" data-path=""><a href="#subsetting"><i class="fa fa-check"></i><b>1.1.3</b> Subsetting</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path=""><a href="#spreadsheets"><i class="fa fa-check"></i><b>1.2</b> Spreadsheets</a><ul>
<li class="chapter" data-level="1.2.1" data-path=""><a href="#excel-files"><i class="fa fa-check"></i><b>1.2.1</b> Excel files</a></li>
<li class="chapter" data-level="1.2.2" data-path=""><a href="#google-sheets"><i class="fa fa-check"></i><b>1.2.2</b> Google Sheets</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path=""><a href="#csvs"><i class="fa fa-check"></i><b>1.3</b> CSVs</a><ul>
<li class="chapter" data-level="1.3.1" data-path=""><a href="#downloading-csv-files"><i class="fa fa-check"></i><b>1.3.1</b> Downloading CSV files</a></li>
<li class="chapter" data-level="1.3.2" data-path=""><a href="#reading-csvs-into-r"><i class="fa fa-check"></i><b>1.3.2</b> Reading CSVs into R</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path=""><a href="#tsvs"><i class="fa fa-check"></i><b>1.4</b> TSVs</a><ul>
<li class="chapter" data-level="1.4.1" data-path=""><a href="#reading-tsvs-into-r"><i class="fa fa-check"></i><b>1.4.1</b> Reading TSVs into R</a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path=""><a href="#delimited-files"><i class="fa fa-check"></i><b>1.5</b> Delimited Files</a><ul>
<li class="chapter" data-level="1.5.1" data-path=""><a href="#reading-delimited-files-into-r"><i class="fa fa-check"></i><b>1.5.1</b> Reading Delimited Files into R</a></li>
</ul></li>
<li class="chapter" data-level="1.6" data-path=""><a href="#exporting-data-from-r"><i class="fa fa-check"></i><b>1.6</b> Exporting Data from R</a></li>
<li class="chapter" data-level="1.7" data-path=""><a href="#json"><i class="fa fa-check"></i><b>1.7</b> JSON</a></li>
<li class="chapter" data-level="1.8" data-path=""><a href="#xml"><i class="fa fa-check"></i><b>1.8</b> XML</a></li>
<li class="chapter" data-level="1.9" data-path=""><a href="#databases"><i class="fa fa-check"></i><b>1.9</b> Databases</a><ul>
<li class="chapter" data-level="1.9.1" data-path=""><a href="#relational-data"><i class="fa fa-check"></i><b>1.9.1</b> Relational Data</a></li>
<li class="chapter" data-level="1.9.2" data-path=""><a href="#relational-databases-sql"><i class="fa fa-check"></i><b>1.9.2</b> Relational Databases: <code>SQL</code></a></li>
<li class="chapter" data-level="1.9.3" data-path=""><a href="#connecting-to-databases-rsqlite"><i class="fa fa-check"></i><b>1.9.3</b> Connecting to Databases: <code>RSQLite</code></a></li>
<li class="chapter" data-level="1.9.4" data-path=""><a href="#working-with-relational-data-dplyr-dbplyr"><i class="fa fa-check"></i><b>1.9.4</b> Working with Relational Data: <code>dplyr</code> &amp; <code>dbplyr</code></a></li>
<li class="chapter" data-level="1.9.5" data-path=""><a href="#mutating-joins"><i class="fa fa-check"></i><b>1.9.5</b> Mutating Joins</a></li>
<li class="chapter" data-level="1.9.6" data-path=""><a href="#filtering-joins"><i class="fa fa-check"></i><b>1.9.6</b> Filtering Joins</a></li>
<li class="chapter" data-level="1.9.7" data-path=""><a href="#how-to-connect-to-a-database-online"><i class="fa fa-check"></i><b>1.9.7</b> How to Connect to a Database Online</a></li>
</ul></li>
<li class="chapter" data-level="1.10" data-path=""><a href="#web-scraping"><i class="fa fa-check"></i><b>1.10</b> Web Scraping</a><ul>
<li class="chapter" data-level="1.10.1" data-path=""><a href="#rvest-basics"><i class="fa fa-check"></i><b>1.10.1</b> <code>rvest</code> basics</a></li>
<li class="chapter" data-level="1.10.2" data-path=""><a href="#selectorgadget"><i class="fa fa-check"></i><b>1.10.2</b> SelectorGadget</a></li>
<li class="chapter" data-level="1.10.3" data-path=""><a href="#web-scraping-example"><i class="fa fa-check"></i><b>1.10.3</b> Web Scraping Example</a></li>
<li class="chapter" data-level="1.10.4" data-path=""><a href="#a-final-note-selectorgadget"><i class="fa fa-check"></i><b>1.10.4</b> A final note: SelectorGadget</a></li>
</ul></li>
<li class="chapter" data-level="1.11" data-path=""><a href="#apis"><i class="fa fa-check"></i><b>1.11</b> APIs</a><ul>
<li class="chapter" data-level="1.11.1" data-path=""><a href="#getting-data-httr"><i class="fa fa-check"></i><b>1.11.1</b> Getting Data: <code>httr</code></a></li>
<li class="chapter" data-level="1.11.2" data-path=""><a href="#example-1-githubs-api"><i class="fa fa-check"></i><b>1.11.2</b> Example 1: GitHub’s API</a></li>
<li class="chapter" data-level="1.11.3" data-path=""><a href="#example-2-obtaining-a-csv"><i class="fa fa-check"></i><b>1.11.3</b> Example 2: Obtaining a CSV</a></li>
<li class="chapter" data-level="1.11.4" data-path=""><a href="#read_csv-from-a-url"><i class="fa fa-check"></i><b>1.11.4</b> <code>read_csv()</code> from a URL</a></li>
<li class="chapter" data-level="1.11.5" data-path=""><a href="#api-keys"><i class="fa fa-check"></i><b>1.11.5</b> API keys</a></li>
</ul></li>
<li class="chapter" data-level="1.12" data-path=""><a href="#foreign-formats"><i class="fa fa-check"></i><b>1.12</b> Foreign Formats</a><ul>
<li class="chapter" data-level="1.12.1" data-path=""><a href="#haven"><i class="fa fa-check"></i><b>1.12.1</b> <code>haven</code></a></li>
</ul></li>
<li class="chapter" data-level="1.13" data-path=""><a href="#images"><i class="fa fa-check"></i><b>1.13</b> Images</a></li>
<li class="chapter" data-level="1.14" data-path=""><a href="#googledrive"><i class="fa fa-check"></i><b>1.14</b> <code>googledrive</code></a></li>
<li class="chapter" data-level="1.15" data-path=""><a href="#case-studies"><i class="fa fa-check"></i><b>1.15</b> Case Studies</a><ul>
<li class="chapter" data-level="1.15.1" data-path=""><a href="#case-study-1-health-expenditures"><i class="fa fa-check"></i><b>1.15.1</b> Case Study #1: Health Expenditures</a></li>
<li class="chapter" data-level="1.15.2" data-path=""><a href="#case-study-2-firearms"><i class="fa fa-check"></i><b>1.15.2</b> Case Study #2: Firearms</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./"></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<!--bookdown:title:end-->
<!--bookdown:title:start-->
<div id="get-data" class="section level1">
<h1><span class="header-section-number">Chapter 1</span> Getting Data Into R</h1>
<p>Data are stored in all sorts of different file formats and structures. In this course, we’ll discuss each of these common formats and discuss how to get them into R so you can start working with them!</p>
<div id="tibbles" class="section level2">
<h2><span class="header-section-number">1.1</span> Tibbles</h2>
<p>Before we can discuss any particular file format, let’s discuss the end goal - the <strong>tibble</strong>! If you’ve been using R for a while, you’re likely famililar with the data.frame. It’s best to think of tibbles as an updated and stylish version of the data.frame. And, tibbles are what tidyverse packages work with most seemlessly. Now, that doesn’t mean tidyverse packages <em>require</em> tibbles. In fact, they still work with data.frames, but the more you work with tidyverse and tidyverse-adjacent packages, the more you’ll see the advantages of using tibbles.</p>
<p>Before we go any further, tibbles <em>are</em> data frames, but they have some new bells and whistles to make your life easier.</p>
<div id="how-tibbles-differ-from-data.frame" class="section level3">
<h3><span class="header-section-number">1.1.1</span> How tibbles differ from data.frame</h3>
<p>There are a number of differences between tibbles and data.frames. To see a full vignette about tibbles and how they differ from data.frame, you’ll want to execute <code>vignette(&quot;tibble&quot;)</code> and read through that vignette. However, we’ll summarize some of the most important points here:</p>
<ul>
<li><strong>Input type remains unchanged</strong> - data.frame is notorious for treating strings as factors; this will not happen with tibbles</li>
<li><strong>Variable names remain unchanged</strong> - In base R, data.frame will remove spaces from names, converting them to periods or add “x” before numeric column names. Tibbles will not change variable (column) names on you</li>
<li><strong>There are no <code>row.names()</code> for a tibble</strong> - Tidy data requires that variables be stored in a consistent way, removing the need for row names.</li>
<li><strong>Tibbles print first ten rows and columns that fit on one screen</strong> - Printing a tibble to screen will never print the entire huge dataframe out. By default, it just shows what fits to your screen.</li>
</ul>
</div>
<div id="creating-a-tibble" class="section level3">
<h3><span class="header-section-number">1.1.2</span> Creating a tibble</h3>
<p>The tibble package is part of the <code>tidyverse</code> and can thus be loaded in (once installed) using:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="kw">library</span>(tidyverse)</a></code></pre></div>
<div id="as_tibble" class="section level4">
<h4><span class="header-section-number">1.1.2.1</span> <code>as_tibble()</code></h4>
<p>Since many packages use the historical data.frame from base R, you’ll often find yourself in the situation that you have a data.frame and want to convert that data.frame to a tibble. To do so, the <code>as_tibble()</code> function is exactly what you’re looking for.</p>
<p>For example, the <code>trees</code> dataset is a data.frame that’s available in base R. This dataset stores the diameter, height and volume for Black Cherry Trees. To convert this data.frame to a tibble you would use the following:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1"><span class="kw">as_tibble</span>(trees)</a></code></pre></div>
<pre><code>## # A tibble: 31 x 3
##    Girth Height Volume
##    &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
##  1   8.3     70   10.3
##  2   8.6     65   10.3
##  3   8.8     63   10.2
##  4  10.5     72   16.4
##  5  10.7     81   18.8
##  6  10.8     83   19.7
##  7  11       66   15.6
##  8  11       75   18.2
##  9  11.1     80   22.6
## 10  11.2     75   19.9
## # … with 21 more rows</code></pre>
<p>Note in the above example and as mentioned earlier, that tibbles, by default, only print the first ten rows to screen. If you were to print <code>trees</code> to screen, all 31 rows would be displayed. When working with large data.frames, this default behavior can be incredibly frustrating. tibbles remove this frustration with its default settings for tibble printing.</p>
<p>Additionally, you’ll note that the type of the variable is printed for each variable in the tibble. This helpful feature is another added bonus of tibbles relative to data.frame.</p>
<p>If you <em>do</em> want to see more rows from the tibble, there are a few options! First, the <code>View()</code> function in RStudio is incredibly helpful. The input to this function is the data.frame or tibble you’d like to see. Specifically, <code>View(trees)</code> would provide you, the viewer, with a scrollable view (in a new tab) of the complete dataset.</p>
<p>A second option is the fact that <code>print()</code> enables you to specify how many rows and columns you’d like to display. Here, we again display the <code>trees</code> data.frame as a tibble but specify that we’d only like to see 5 rows. <code>width = Inf</code> specifies that we’d like to see all the possible columns. Here, there are only 3, but for larger datasets, this can be helpful to specify.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1"><span class="kw">as_tibble</span>(trees) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb4-2" title="2"><span class="st">  </span><span class="kw">print</span>(<span class="dt">n =</span> <span class="dv">5</span>, <span class="dt">width =</span> <span class="ot">Inf</span>)</a></code></pre></div>
<pre><code>## # A tibble: 31 x 3
##   Girth Height Volume
##   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
## 1   8.3     70   10.3
## 2   8.6     65   10.3
## 3   8.8     63   10.2
## 4  10.5     72   16.4
## 5  10.7     81   18.8
## # … with 26 more rows</code></pre>
</div>
<div id="tibble" class="section level4">
<h4><span class="header-section-number">1.1.2.2</span> <code>tibble()</code></h4>
<p>Alternatively, you can create a tibble on the fly by using <code>tibble()</code> and specifying the information you’d like stored in each column. Note that if you provide a single value, this value will be repeated across all rows of the tibble. This is referred to as “recycling inputs of lenth 1.”</p>
<p>In the example here, we see that the column <code>c</code> will contain the value ‘1’ across all rows.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1"><span class="kw">tibble</span>(</a>
<a class="sourceLine" id="cb6-2" title="2">  <span class="dt">a =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>,</a>
<a class="sourceLine" id="cb6-3" title="3">  <span class="dt">b =</span> <span class="dv">6</span><span class="op">:</span><span class="dv">10</span>,</a>
<a class="sourceLine" id="cb6-4" title="4">  <span class="dt">c =</span> <span class="dv">1</span>,</a>
<a class="sourceLine" id="cb6-5" title="5">  <span class="dt">z =</span> (a <span class="op">+</span><span class="st"> </span>b)<span class="op">^</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span>c</a>
<a class="sourceLine" id="cb6-6" title="6">)</a></code></pre></div>
<pre><code>## # A tibble: 5 x 4
##       a     b     c     z
##   &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1     1     6     1    50
## 2     2     7     1    82
## 3     3     8     1   122
## 4     4     9     1   170
## 5     5    10     1   226</code></pre>
<p>The <code>tibble()</code> function allows you to quickly generate tibbles and even allows you to reference columns within the tibble you’re creating, as seen in column z of the example above.</p>
<p>We also noted previously that tibbles can have column names that are not allowed in data.frame. In this example, we see that to utilize a nontraditional variable name, you surround the column name with backticks. Note that to refer to such columns in other tidyverse packages, you’ll continue to use backticks surrounding the variable name.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" title="1"><span class="kw">tibble</span>(</a>
<a class="sourceLine" id="cb8-2" title="2">  <span class="st">`</span><span class="dt">two words</span><span class="st">`</span> =<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">5</span>,</a>
<a class="sourceLine" id="cb8-3" title="3">  <span class="st">`</span><span class="dt">12</span><span class="st">`</span> =<span class="st"> &quot;numeric&quot;</span>,</a>
<a class="sourceLine" id="cb8-4" title="4">  <span class="st">`</span><span class="dt">:)</span><span class="st">`</span> =<span class="st"> &quot;smile&quot;</span>,</a>
<a class="sourceLine" id="cb8-5" title="5">)</a></code></pre></div>
<pre><code>## # A tibble: 5 x 3
##   `two words` `12`    `:)` 
##         &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;
## 1           1 numeric smile
## 2           2 numeric smile
## 3           3 numeric smile
## 4           4 numeric smile
## 5           5 numeric smile</code></pre>
</div>
</div>
<div id="subsetting" class="section level3">
<h3><span class="header-section-number">1.1.3</span> Subsetting</h3>
<p>Subsetting tibbles also differs slightly from how subsetting occurs with data.frame. When it comes to tibbles, <code>[[</code> can subset by name or position;`<code>$</code> only subsets by name. For example:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" title="1">df &lt;-<span class="st"> </span><span class="kw">tibble</span>(</a>
<a class="sourceLine" id="cb10-2" title="2">  <span class="dt">a =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>,</a>
<a class="sourceLine" id="cb10-3" title="3">  <span class="dt">b =</span> <span class="dv">6</span><span class="op">:</span><span class="dv">10</span>,</a>
<a class="sourceLine" id="cb10-4" title="4">  <span class="dt">c =</span> <span class="dv">1</span>,</a>
<a class="sourceLine" id="cb10-5" title="5">  <span class="dt">z =</span> (a <span class="op">+</span><span class="st"> </span>b)<span class="op">^</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span>c</a>
<a class="sourceLine" id="cb10-6" title="6">)</a>
<a class="sourceLine" id="cb10-7" title="7"></a>
<a class="sourceLine" id="cb10-8" title="8"><span class="co"># Extract by name using $ or [[]]</span></a>
<a class="sourceLine" id="cb10-9" title="9">df<span class="op">$</span>z</a></code></pre></div>
<pre><code>## [1]  50  82 122 170 226</code></pre>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" title="1">df[[<span class="st">&quot;z&quot;</span>]]</a></code></pre></div>
<pre><code>## [1]  50  82 122 170 226</code></pre>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" title="1"><span class="co"># Extract by position requires [[]]</span></a>
<a class="sourceLine" id="cb14-2" title="2">df[[<span class="dv">4</span>]]</a></code></pre></div>
<pre><code>## [1]  50  82 122 170 226</code></pre>
<p>Having now discussed tibbles, which are the type of object most tidyverse and tidyverse-adjacent packages work best with, we now know the goal. In many cases, tibbles are ultimately what we want to work with in R. However, data are stored in many different formats outside of R. We’ll spend the rest of this course discussing those formats and talking about how to get those data into R so that you can start the process of working with and analyzing these data in R.</p>
</div>
</div>
<div id="spreadsheets" class="section level2">
<h2><span class="header-section-number">1.2</span> Spreadsheets</h2>
<p>Spreadsheets are an incredibly common format in which data are stored. If you’ve ever worked in Microsoft Excel or Google Sheets, you’ve worked with spreadsheets. By definition, spreadsheets require that information be stored in a grid utilizing rows and columns.</p>
<div id="excel-files" class="section level3">
<h3><span class="header-section-number">1.2.1</span> Excel files</h3>
<p>Microsoft Excel files, which typically have the file extention .xls or .xlsx, store information in a workbook. Each workbook is made up of one or more spreadsheet. Within these spreadsheets, information is stored in the format of values and formatting (colors, conditional formatting, font size, etc.). While this may be a format you’ve worked with before and are familiar, we note that Excel files can only be viewed in specific pieces of software (like Microsoft Excel), and thus are generally less flexible than many of the other fomrats we’ll discuss in this course. Additionally, Excel has certain defaults that make working with Excel data difficult outside of Excel. For example, Excel has a habit of aggressively changing data types. For example if you type 1/2, to mean 0.5 or one-half, Excel assumes that this is a date and converts this information to January 2nd. If you are unfamiliar with these defaults, your spreadsheet can sometimes store information other than what you or whoever entered the data into the Excel spreadsheet may have intended. Thus, it’s important to understand the quirks of how Excel handles data. Nevertheless, many people <em>do</em> save their data in Excel, so it’s important to know how to work with them in R.</p>
<div id="reading-excel-files-into-r" class="section level4">
<h4><span class="header-section-number">1.2.1.1</span> Reading Excel files into R</h4>
<p>Reading spreadhseets from Excel into R is made possible thanks to the <code>readxl</code> package. This is not a core tidyverse package, so you’ll need to install and load the package in before use:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" title="1"><span class="kw">library</span>(readxl)</a></code></pre></div>
<p>The function <code>read_excel()</code> is particularly helpful whenever you want read an Excel file into your R Environment. The only required argument of this function is the path to the Excel file on your computer. In the following example, <code>read_excel()</code> would look for the file “filename.xlsx” in your current working directory. If the file were located somewhere else on your computer, you would have to provide the <em>path</em> to that file.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" title="1"><span class="co"># read Excel file into R</span></a>
<a class="sourceLine" id="cb17-2" title="2">df_excel &lt;-<span class="st"> </span><span class="kw">read_excel</span>(<span class="st">&quot;filename.xlsx&quot;</span>)</a></code></pre></div>
<p>Within the <code>readxl</code> package there are a number of example datasets that we can use to demonstrate the packages functionality. To read the example dataset in, we’ll use the <code>readxl_example()</code> function.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" title="1"><span class="co"># read example file into R</span></a>
<a class="sourceLine" id="cb18-2" title="2">example &lt;-<span class="st"> </span><span class="kw">readxl_example</span>(<span class="st">&quot;datasets.xlsx&quot;</span>)</a>
<a class="sourceLine" id="cb18-3" title="3">df &lt;-<span class="st"> </span><span class="kw">read_excel</span>(example)</a>
<a class="sourceLine" id="cb18-4" title="4">df</a></code></pre></div>
<pre><code>## # A tibble: 150 x 5
##    Sepal.Length Sepal.Width Petal.Length Petal.Width Species
##           &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;       &lt;dbl&gt; &lt;chr&gt;  
##  1          5.1         3.5          1.4         0.2 setosa 
##  2          4.9         3            1.4         0.2 setosa 
##  3          4.7         3.2          1.3         0.2 setosa 
##  4          4.6         3.1          1.5         0.2 setosa 
##  5          5           3.6          1.4         0.2 setosa 
##  6          5.4         3.9          1.7         0.4 setosa 
##  7          4.6         3.4          1.4         0.3 setosa 
##  8          5           3.4          1.5         0.2 setosa 
##  9          4.4         2.9          1.4         0.2 setosa 
## 10          4.9         3.1          1.5         0.1 setosa 
## # … with 140 more rows</code></pre>
<p>Note that the information stored in <code>df</code> is a tibble. This will be a common theme throughout the packages used in these courses.</p>
<p>Further, by default, <code>read_excel()</code> converts blank cells to missing data (NA). This behavior can be changed by specifying the <code>na</code> argument within this function. There are a number of additional helpful arguments within this function. They can all be seen using <code>?read_excel</code>, but we’ll highlight a few here:</p>
<ul>
<li><code>sheet</code> - argument specifies the name of the sheet from the workbook you’d like to read in (string) or the integer of the sheet from teh workbook.</li>
<li><code>col_names</code> - specifies whether the first row of the spreadsheet should be used as column names (dfault: TRUE). Additionally, if a chracter vector is passed, this will rename the columns exlicitly at time of import.</li>
<li><code>skip</code> - specifies the number of rows to skip before reading information from the file into R. Often blank rows or information about the data are stored at the top of the spreadsheet that you want R to ignore</li>
</ul>
<p>For an example, we are able to change the column names directly by passing a character string to the <code>col_names</code> argument:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" title="1"><span class="co"># specify column names on import</span></a>
<a class="sourceLine" id="cb20-2" title="2"><span class="kw">read_excel</span>(example, <span class="dt">col_names =</span> LETTERS[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>])</a></code></pre></div>
<pre><code>## # A tibble: 151 x 5
##    A            B           C            D           E      
##    &lt;chr&gt;        &lt;chr&gt;       &lt;chr&gt;        &lt;chr&gt;       &lt;chr&gt;  
##  1 Sepal.Length Sepal.Width Petal.Length Petal.Width Species
##  2 5.1          3.5         1.4          0.2         setosa 
##  3 4.9          3           1.4          0.2         setosa 
##  4 4.7          3.2         1.3          0.2         setosa 
##  5 4.6          3.1         1.5          0.2         setosa 
##  6 5            3.6         1.4          0.2         setosa 
##  7 5.4          3.9         1.7          0.4         setosa 
##  8 4.6          3.4         1.4          0.3         setosa 
##  9 5            3.4         1.5          0.2         setosa 
## 10 4.4          2.9         1.4          0.2         setosa 
## # … with 141 more rows</code></pre>
<p>To take this a step further let’s discuss one of the lesser-known arguments of the <code>read_excel()</code> function: <code>.name_repair</code>. This argument allows for further fine-tuning and handling of column names.</p>
<p>The default for this argument is <code>.name_repair = &quot;unique&quot;</code>. This checks to make sure that each column of the imported file has a unique name. If TRUE, readxl leaves them as is, as you see in the example here:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" title="1"><span class="co"># read example file into R using .name_repair default</span></a>
<a class="sourceLine" id="cb22-2" title="2"><span class="kw">read_excel</span>(</a>
<a class="sourceLine" id="cb22-3" title="3">  <span class="kw">readxl_example</span>(<span class="st">&quot;deaths.xlsx&quot;</span>),</a>
<a class="sourceLine" id="cb22-4" title="4">  <span class="dt">range =</span> <span class="st">&quot;arts!A5:F8&quot;</span>,</a>
<a class="sourceLine" id="cb22-5" title="5">  <span class="dt">.name_repair =</span> <span class="st">&quot;unique&quot;</span></a>
<a class="sourceLine" id="cb22-6" title="6">)</a></code></pre></div>
<pre><code>## # A tibble: 3 x 6
##   Name  Profession   Age `Has kids` `Date of birth`     `Date of death`    
##   &lt;chr&gt; &lt;chr&gt;      &lt;dbl&gt; &lt;lgl&gt;      &lt;dttm&gt;              &lt;dttm&gt;             
## 1 Davi… musician      69 TRUE       1947-01-08 00:00:00 2016-01-10 00:00:00
## 2 Carr… actor         60 TRUE       1956-10-21 00:00:00 2016-12-27 00:00:00
## 3 Chuc… musician      90 TRUE       1926-10-18 00:00:00 2017-03-18 00:00:00</code></pre>
<p>Another option for this argument is <code>.name_repair = &quot;universal&quot;</code>. This ensures that column names don’t contain any forbidden characters or reserved words. It’s often a good idea to use this option if you plan to use these data in other packages downstream. This ensures that all the column names will work, regardless of the R package being used.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" title="1"><span class="co"># require use of universal naming conventions</span></a>
<a class="sourceLine" id="cb24-2" title="2"><span class="kw">read_excel</span>(</a>
<a class="sourceLine" id="cb24-3" title="3">  <span class="kw">readxl_example</span>(<span class="st">&quot;deaths.xlsx&quot;</span>),</a>
<a class="sourceLine" id="cb24-4" title="4">  <span class="dt">range =</span> <span class="st">&quot;arts!A5:F8&quot;</span>,</a>
<a class="sourceLine" id="cb24-5" title="5">  <span class="dt">.name_repair =</span> <span class="st">&quot;universal&quot;</span></a>
<a class="sourceLine" id="cb24-6" title="6">)</a></code></pre></div>
<pre><code>## New names:
## * `Has kids` -&gt; Has.kids
## * `Date of birth` -&gt; Date.of.birth
## * `Date of death` -&gt; Date.of.death</code></pre>
<pre><code>## # A tibble: 3 x 6
##   Name    Profession   Age Has.kids Date.of.birth       Date.of.death      
##   &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;lgl&gt;    &lt;dttm&gt;              &lt;dttm&gt;             
## 1 David … musician      69 TRUE     1947-01-08 00:00:00 2016-01-10 00:00:00
## 2 Carrie… actor         60 TRUE     1956-10-21 00:00:00 2016-12-27 00:00:00
## 3 Chuck … musician      90 TRUE     1926-10-18 00:00:00 2017-03-18 00:00:00</code></pre>
<p>Note that when using <code>.name_repair = &quot;universal&quot;</code>, you’ll get a readout about which column names have been changed. Here you see that column names with a space in them have been chnaged to periods for word separation.</p>
<p>Aside from these options, functions can be passed to <code>.name_repair</code>. For example, if you want all of your column names to be uppercase, you would use the following:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" title="1"><span class="co"># pass function for column naming</span></a>
<a class="sourceLine" id="cb27-2" title="2"><span class="kw">read_excel</span>(</a>
<a class="sourceLine" id="cb27-3" title="3">  <span class="kw">readxl_example</span>(<span class="st">&quot;deaths.xlsx&quot;</span>),</a>
<a class="sourceLine" id="cb27-4" title="4">  <span class="dt">range =</span> <span class="st">&quot;arts!A5:F8&quot;</span>,</a>
<a class="sourceLine" id="cb27-5" title="5">  <span class="dt">.name_repair =</span> toupper</a>
<a class="sourceLine" id="cb27-6" title="6">)</a></code></pre></div>
<pre><code>## # A tibble: 3 x 6
##   NAME  PROFESSION   AGE `HAS KIDS` `DATE OF BIRTH`     `DATE OF DEATH`    
##   &lt;chr&gt; &lt;chr&gt;      &lt;dbl&gt; &lt;lgl&gt;      &lt;dttm&gt;              &lt;dttm&gt;             
## 1 Davi… musician      69 TRUE       1947-01-08 00:00:00 2016-01-10 00:00:00
## 2 Carr… actor         60 TRUE       1956-10-21 00:00:00 2016-12-27 00:00:00
## 3 Chuc… musician      90 TRUE       1926-10-18 00:00:00 2017-03-18 00:00:00</code></pre>
<p>Notice that the function is passed directly to the argument. It does not have quotes around it, as we want this to be interpreted as the <code>toupper()</code> function.</p>
<p>Here we’ve really only focused on a single function (<code>read_excel()</code>) from the <code>readxl</code> package. This is because some of the best packages do a single thing and do that single thing well. The <code>readxl</code> package has a single, slick function that covers most of what you’ll need when reading in files from Excel. That is not to say that hte package doesn’t have other function (it does!), but this function will cover your needs most of the time.</p>
</div>
</div>
<div id="google-sheets" class="section level3">
<h3><span class="header-section-number">1.2.2</span> Google Sheets</h3>
<p>Similar to Microsoft Excel, Google Sheets is another place in which spreadsheet information is stored. Google Sheets also stores informtaion in spreadsheets within workbooks. Like Excel, it allows for cell formatting and has defaults during data entry that <em>could</em> get you into trouble if you’re not familiar with the program.</p>
<p>Unlike Excel files, however, Google Sheets live on the Internet, rather than your computer. This makes sharing and updating Google Sheets among people working on the same project much quicker. This also makes the process for reading them into R slightly different. Accordingly, it requires the use of a different, but also very helpful package, <code>googlesheets</code>!</p>
<p>As Google Sheets are stored on the Internet and not on your computer, the <code>googlesheets</code> package does not require you to download the file to your computer before reading it into R. Instead, it reads the data into R directly from Google Sheets. Note that if the data hosted on Google Sheets changes, every time the file is read into R, the most updated version of the file will be utilized. This can be very helpful if you’re collecting data over time; however, it could lead to unexpected changes in results if you’re not aware that the data in the Google Sheet is changing.</p>
<p>To see exactly what we mean, let’s look at a specific example. Imagine you’ve sent out a survey to your friends asking about how they spend their day. Let’s say you’re mostly interested in knowing the hours spent on work, leisure, sleep, eating, socializing, and other activities. So in your Google Sheet you add these six items as columns and one column asking for your friends names. To collect this data, you then share the link with your friends, giving them the ability to edit the Google Sheet.</p>
<div class="figure">
<img src="https://docs.google.com/presentation/d/1BtZv6mbC0ufQASlkWjdnXY1MQKVsC3Mo0rGmzfMadyA/export/png?id=1BtZv6mbC0ufQASlkWjdnXY1MQKVsC3Mo0rGmzfMadyA&amp;pageid=g2bfdb07292_0_151" alt="Survey Google Sheets" />
<p class="caption">Survey Google Sheets</p>
</div>
<p>Your friends will then one-by-one complete the survey. And, because it’s a Google Sheet, everyone will be able to update the Google Sheet, regardless of whether or not someone else is also looking at the Sheet at the same time. As they do, you’ll be able to pull the data and import it to R for analysis at any point. You won’t have to wait for everyone to respond. You’ll be able to analyze the results in real-time by directly reading it into R from Google Sheets, avoiding the need to download it each time you do so.</p>
<p>In other words, every time you import the data from the Google Sheets link using the <code>googlesheets</code> package, the most updated data will be imported. Let’s say, after waiting for a week, your friends’ data look something like this:</p>
<div class="figure">
<img src="https://docs.google.com/presentation/d/1BtZv6mbC0ufQASlkWjdnXY1MQKVsC3Mo0rGmzfMadyA/export/png?id=1BtZv6mbC0ufQASlkWjdnXY1MQKVsC3Mo0rGmzfMadyA&amp;pageid=g398ce98dcf_0_1" alt="Survey Data" />
<p class="caption">Survey Data</p>
</div>
<p>You’d be able to analyze these updated data using R and the <code>googlesheets</code> package!</p>
<p>In fact, let’s have you do that right now! Click on <a href="https://docs.google.com/spreadsheets/d/e/2PACX-1vSOaV-SM4nI7HrtZs8GDSL9Wgyfl0kv_vlaIdYiueBZDPpKejKFF3zzT_eKk8TG3V6oW7xcMBV9VYR3/pubhtml">this link</a> to see these data!</p>
<div id="the-googlesheets-package" class="section level4">
<h4><span class="header-section-number">1.2.2.1</span> The <code>googlesheets</code> package</h4>
<p>The <code>googlesheets</code> package allows R users to take advantage of the Google Sheets Application Programming Interface (API). Very generally, APIs allow different applications to communicate with one another. In this case, Google has released an API that allows other software to communicate with Google Sheets and retrieve data and information directly from Google Sheets. The <code>googlesheets</code> package enables R users (you!) to easily access the Google Sheets API and retrieve your Google Sheets data.</p>
<p>Using this package is is the best and easiest way to analyze and edit Google Sheets data in R. In addition to the ability of pulling data, you can also edit a Google Sheet or create new sheets.</p>
<p>The <code>googlesheets</code> package is tidyverse-adjacent, so it requires its own installation and for you to load it into R before it can be used</p>
<div id="getting-started-with-googlesheets" class="section level5">
<h5><span class="header-section-number">1.2.2.1.1</span> Getting Started with <code>googlesheets</code></h5>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb29-1" title="1"><span class="co"># load package</span></a>
<a class="sourceLine" id="cb29-2" title="2"><span class="kw">library</span>(googlesheets)</a></code></pre></div>
<p>Now, let’s get to importing your survey data into R. Every time you start a new session, you need to authenticate the use of <code>googlesheets</code> package with your Google account. This is a great features as it ensures that you <em>want</em> to allow access to your Google Sheets and allows the Google Sheets API to make sure that you <em>should</em> have access to the files you’re going to try to access.</p>
<p>The command <code>gs_auth(new_user = TRUE)</code> will open a new page in your browser that asks you which Google account’s Google Sheets you’d like to give access to. Click on the appropriate Google user to provide <code>googlesheets</code> access to the Google Sheets API.</p>
<div class="figure">
<img src="https://docs.google.com/presentation/d/1BtZv6mbC0ufQASlkWjdnXY1MQKVsC3Mo0rGmzfMadyA/export/png?id=1BtZv6mbC0ufQASlkWjdnXY1MQKVsC3Mo0rGmzfMadyA&amp;pageid=g3d555bce3d_0_4" alt="Authenticate" />
<p class="caption">Authenticate</p>
</div>
<p>After you click “ALLOW”, giving permission for the <code>googlesheets</code> package to connect to your Google account, you will likely be shown a screen where you will be asked to copy an authentication code. Copy this authentication code and paste it into R.</p>
<div class="figure">
<img src="https://docs.google.com/presentation/d/1BtZv6mbC0ufQASlkWjdnXY1MQKVsC3Mo0rGmzfMadyA/export/png?id=1BtZv6mbC0ufQASlkWjdnXY1MQKVsC3Mo0rGmzfMadyA&amp;pageid=g3d555bce3d_0_12" alt="Allow" />
<p class="caption">Allow</p>
</div>
</div>
<div id="navigating-googlesheets-gs_ls-and-gs_title" class="section level5">
<h5><span class="header-section-number">1.2.2.1.2</span> Navigating <code>googlesheets</code>: <code>gs_ls()</code> and <code>gs_title()</code></h5>
<p>Once authenticated, you can use the command <code>gs_ls()</code> to list all your worksheets on Google Sheets as a table.</p>
<p>In order to ultimately access the information a specific Google Sheet, you have to first <strong>register</strong> the sheet. To do this we’ll use <code>gs_title()</code>. For the example below to work, you’ll need to have a Google Sheet named “survey” in your account. To access this sheet, navigate to [<a href="https://docs.google.com/spreadsheets/d/1FN7VVKzJJyifZFY5POdz_LalGTBYaC4SLB-X9vyDnbY/" class="uri">https://docs.google.com/spreadsheets/d/1FN7VVKzJJyifZFY5POdz_LalGTBYaC4SLB-X9vyDnbY/</a>] in your web browser.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb30-1" title="1"><span class="co"># register Google Sheet</span></a>
<a class="sourceLine" id="cb30-2" title="2">survey_sheet &lt;-<span class="st"> </span><span class="kw">gs_title</span>(<span class="st">&quot;survey&quot;</span>)</a></code></pre></div>
<p>Note that we assign the information stored from registering this Google Sheet to the object <code>survey_sheet</code> so that we can use it again shortly.</p>
<p>If you type the name of the sheet correctly <em>and</em> it exists in your Google Drive, you will see a message that says <em>Sheet successfully identified: “survey”</em>.</p>
<div class="figure">
<img src="https://docs.google.com/presentation/d/1BtZv6mbC0ufQASlkWjdnXY1MQKVsC3Mo0rGmzfMadyA/export/png?id=1BtZv6mbC0ufQASlkWjdnXY1MQKVsC3Mo0rGmzfMadyA&amp;pageid=g3d555bce3d_0_23" alt="Sheet successfully identified" />
<p class="caption">Sheet successfully identified</p>
</div>
</div>
<div id="reading-data-in-using-googlesheets-gs_read" class="section level5">
<h5><span class="header-section-number">1.2.2.1.3</span> Reading data in using <code>googlesheets</code>: <code>gs_read()</code></h5>
<p>At this point, your Google Sheet is registered and you can now read the data into R using the function <code>gs_read()</code>. The <code>survey_sheet</code> object output you generated using <code>gs_title()</code> will now be the input to <code>gs_read()</code>:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb31-1" title="1"><span class="co"># access information stored in survey_sheet</span></a>
<a class="sourceLine" id="cb31-2" title="2">survey_data &lt;-<span class="st"> </span><span class="kw">gs_read</span>(survey_sheet)</a></code></pre></div>
<div class="figure">
<img src="https://docs.google.com/presentation/d/1BtZv6mbC0ufQASlkWjdnXY1MQKVsC3Mo0rGmzfMadyA/export/png?id=1BtZv6mbC0ufQASlkWjdnXY1MQKVsC3Mo0rGmzfMadyA&amp;pageid=g3d555bce3d_0_28" alt="Sheet successfully read into R" />
<p class="caption">Sheet successfully read into R</p>
</div>
<p>There are additional (optional) arguments to <code>gs_read()</code>, some are similar to those in <code>read_csv()</code> and <code>read_excel(),</code> while others are more specific to reading in Google Sheets:</p>
<ul>
<li><code>skip = 1</code> : will skip the first row of the Google Sheet</li>
<li><code>ws = 1</code> : specifies that you want <code>googlesheets</code> to read in the first worksheet in your Google Sheet</li>
<li><code>col_names = FALSE</code> : specifies that the first row is not column names</li>
<li><code>range = &quot;A1:G5&quot;</code> : specifies the range of cells that we like to import is A1 to G5.</li>
<li><code>n_max = 100</code> : specifies the maximum number of rows that we want to import is 100.</li>
</ul>
<p><code>gs_title()</code> is not the only way in which a sheet can be registered. Google Sheetes can also be registered by URL or key. Within the Google Sheets package, a practice Google Sheet is available for you so that you can familiarize yourself with these approaches before working with your own data.</p>
<p>There is a dataset provided as an example with the <code>googlesheets package</code>. The data stored in the example dataset come from the <a href="https://www.gapminder.org/">Gapminder dataset</a>. This includes longitudinal data about a few global economic variables. We’ll use this dataset to discuss registering a Google Sheet by key or URL.</p>
<p>To register a Google sheet in <code>googlesheets</code> by key, you must first know the key of the Google Sheet and have access to it. To work through a full example here you’ll first want to navigate to [<a href="https://docs.google.com/spreadsheets/d/1BzfL0kZUz1TsI5zxJF1WNF01IxvC67FbOJUiiGMZ_mQ/" class="uri">https://docs.google.com/spreadsheets/d/1BzfL0kZUz1TsI5zxJF1WNF01IxvC67FbOJUiiGMZ_mQ/</a>] in your web browser. This will open up the gapminder dataset in Google Sheets so that you can have a look at the data in Google Sheets.</p>
<div class="figure">
<img src="https://docs.google.com/presentation/d/1tKBs1sYK4dIZeCQt4sc7o88cuPkXA3eVfZ4Xkns7k-c/export/png?id=1tKBs1sYK4dIZeCQt4sc7o88cuPkXA3eVfZ4Xkns7k-c&amp;pageid=g5fbdfde92a_0_8" alt="Gapminder Dataset in Google Sheets" />
<p class="caption">Gapminder Dataset in Google Sheets</p>
</div>
<p>Now, it’s just up to us to register this information from Google Sheets into R using the <code>googlesheets</code> package. To do this, we could use the <em>title</em> of the sheet, the <em>key</em>, or the <em>URL</em>:</p>
<div class="figure">
<img src="https://docs.google.com/presentation/d/1tKBs1sYK4dIZeCQt4sc7o88cuPkXA3eVfZ4Xkns7k-c/export/png?id=1tKBs1sYK4dIZeCQt4sc7o88cuPkXA3eVfZ4Xkns7k-c&amp;pageid=g6112cc596f_0_4" alt="Where to find the title, key, and URL in Google Sheets" />
<p class="caption">Where to find the title, key, and URL in Google Sheets</p>
</div>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb32-1" title="1"><span class="co"># register in with title </span></a>
<a class="sourceLine" id="cb32-2" title="2"><span class="kw">gs_title</span>(<span class="st">&quot;test-gs-gapminder&quot;</span>)</a>
<a class="sourceLine" id="cb32-3" title="3"></a>
<a class="sourceLine" id="cb32-4" title="4"><span class="co"># register with key</span></a>
<a class="sourceLine" id="cb32-5" title="5"><span class="kw">gs_key</span>(<span class="st">&quot;1BzfL0kZUz1TsI5zxJF1WNF01IxvC67FbOJUiiGMZ_mQ&quot;</span>)</a>
<a class="sourceLine" id="cb32-6" title="6"></a>
<a class="sourceLine" id="cb32-7" title="7"><span class="co"># register with URL</span></a>
<a class="sourceLine" id="cb32-8" title="8"><span class="kw">gs_url</span>(<span class="st">&quot;https://docs.google.com/spreadsheets/d/1BzfL0kZUz1TsI5zxJF1WNF01IxvC67FbOJUiiGMZ_mQ/edit#gid=1150108545&quot;</span>)</a></code></pre></div>
<p>Regardless of how you register the sheet, you’ll get an output to inform you that the sheet was successfully identified. (Note: if you have not opened up the <a href="https://docs.google.com/spreadsheets/d/1BzfL0kZUz1TsI5zxJF1WNF01IxvC67FbOJUiiGMZ_mQ/">Google Sheet</a> using the Google Drive account you specified during authentication, you will get an error.)</p>
<div class="figure">
<img src="https://docs.google.com/presentation/d/1tKBs1sYK4dIZeCQt4sc7o88cuPkXA3eVfZ4Xkns7k-c/export/png?id=1tKBs1sYK4dIZeCQt4sc7o88cuPkXA3eVfZ4Xkns7k-c&amp;pageid=g6112cc596f_0_9" alt="Sheet Successfully Identified" />
<p class="caption">Sheet Successfully Identified</p>
</div>
</div>
<div id="adding-rows-and-editing-cells" class="section level5">
<h5><span class="header-section-number">1.2.2.1.4</span> Adding rows and editing cells</h5>
<p>In addition to reading in data from Google Sheets directly using the <code>googlesheets</code> package, you can also modify your Google Sheet directly through R. For example, returning to our friends’ survey data example, you can edit a cell or add a row to your sheet.</p>
<p>Let’s say you’d like to add your own respond to the survey. For this you can use the command <code>gs_add_row()</code>. Note that the <code>input</code> argument specifies what you would like to add in the new row. If everything goes well, you will get a message saying <em>Row successfully appended</em>.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb33-1" title="1">my_response &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Me&quot;</span>, <span class="dv">10</span>, <span class="dv">8</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb33-2" title="2"><span class="kw">gs_add_row</span>(survey_sheet, <span class="dt">input =</span> my_response)</a></code></pre></div>
<div class="figure">
<img src="https://docs.google.com/presentation/d/1BtZv6mbC0ufQASlkWjdnXY1MQKVsC3Mo0rGmzfMadyA/export/png?id=1BtZv6mbC0ufQASlkWjdnXY1MQKVsC3Mo0rGmzfMadyA&amp;pageid=g398ce98dcf_0_18" alt="gs_add_row()" />
<p class="caption"><code>gs_add_row()</code></p>
</div>
<p>If you now check the sheet on Google Sheets, you will see the appended row.</p>
<div class="figure">
<img src="https://docs.google.com/presentation/d/1BtZv6mbC0ufQASlkWjdnXY1MQKVsC3Mo0rGmzfMadyA/export/png?id=1BtZv6mbC0ufQASlkWjdnXY1MQKVsC3Mo0rGmzfMadyA&amp;pageid=g398ce98dcf_0_23" alt="Survey Data with Added Row" />
<p class="caption">Survey Data with Added Row</p>
</div>
<p>To edit a specific cell you can use the command <code>gs_edit_cell()</code> but you will have to tell <code>googlesheets</code> which specific cell to edit. Let’s say we want to change the value of the cell <em>D4</em> from 0 to 2. For this we will use the <code>gs_edit_cells()</code> function. The <code>anchor</code> argument points to the cell that we want to modify and the <code>input</code> argument contains the new value that we want to assign to the cell.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb34-1" title="1"><span class="kw">gs_edit_cells</span>(survey_sheet, <span class="dt">anchor =</span> <span class="st">&quot;D4&quot;</span>, <span class="dt">input =</span> <span class="dv">2</span>)</a></code></pre></div>
<div class="figure">
<img src="https://docs.google.com/presentation/d/1BtZv6mbC0ufQASlkWjdnXY1MQKVsC3Mo0rGmzfMadyA/export/png?id=1BtZv6mbC0ufQASlkWjdnXY1MQKVsC3Mo0rGmzfMadyA&amp;pageid=g398ce98dcf_0_29" alt="gs_edit_cells()" />
<p class="caption"><code>gs_edit_cells()</code></p>
</div>
<p>If you were to return to your Google Sheets, you’d notice that cell D4 now has a 2, rather than a 0 in it!</p>
</div>
</div>
</div>
</div>
<div id="csvs" class="section level2">
<h2><span class="header-section-number">1.3</span> CSVs</h2>
<p>Like Excel Spreadsheets and Google Sheets, <strong>Comma-separated values (CSV)</strong> files allow us to store tabular data; however, it does this in a much simple format. CSVs are <strong>plain-text</strong> files, which means that all the important information in the file is represented by text (where text is numbers, letters, and symbols you can type on your keyboard). This means that there are no workbooks or metadata making it difficult to open these files. CSVs are flexible files and are thus the preferred storage method for tabular data for many data scientits.</p>
<p>For example, consider a dataset that includes information about the heights and blood types of three individuals. You could make a table that has three columns (names, heights, and blood types) and three rows (one for each person) in Google Docs or Microsoft Word. However, there is a better way of storing this data in plain text without needing to put them in table format. CSVs are a perfect way to store these data. In the CSV format, the values of each column for each person in the data are separated by commas and each row (each person in our case) is separated by a new line. This means your data would be stored in the following format:</p>
<div class="figure">
<img src="https://docs.google.com/presentation/d/199w7E8ggb0nrf40A7WvVIYmNKJdVbUkcWpgnLBysZzM/export/png?id=199w7E8ggb0nrf40A7WvVIYmNKJdVbUkcWpgnLBysZzM&amp;pageid=g2bfdb07292_0_151" alt="sample CSV" />
<p class="caption">sample CSV</p>
</div>
<p>Notice that CSV files have a .csv extension at the end. You can see this above at the top of the file. One of the advantages of CSV files is their <em>simplicity</em>. Because of this, they are one of the most common file formats used to store tabular data. Additionally, because they are plain text, they are compatible with <em>many</em> different types of software. CSVs can be read by most programs. Specifically, for our purposes, these files can be easily read into R (or Google Sheets, or Excel), where they can be better understood by the human eye. Here you see the same CSV opened in Google Slides, where it’s more easily interpretable by the human eye:</p>
<div class="figure">
<img src="https://docs.google.com/presentation/d/199w7E8ggb0nrf40A7WvVIYmNKJdVbUkcWpgnLBysZzM/export/png?id=199w7E8ggb0nrf40A7WvVIYmNKJdVbUkcWpgnLBysZzM&amp;pageid=g3a4d18d722_0_92" alt="CSV opened in Google Slides" />
<p class="caption">CSV opened in Google Slides</p>
</div>
<p>As with any file type, CSVs do have their limitations. Specifically, CSV files are best used for data that have a consistent number of variables across observations. For example, in our example, there are three variables for each observation: “name”, “height”, and “blood_type”. If, however, you had eye color and weight for the second observation, but not for the other rows, you’d have a different number of variables for the second observation than the other two. This type of data is not best suited for CSVs. However, whenever you have information the same number of variables across all observations, CSVs are a good bet!</p>
<div id="downloading-csv-files" class="section level3">
<h3><span class="header-section-number">1.3.1</span> Downloading CSV files</h3>
<p>If you entered the same values used above into Google Slides first and wanted to download this file as a CSV to read into R, you would enter the values in Google slides, and then click on “File” and then “Download” as and choose “Comma-separated values (.csv, current sheet)”. The dataset that you created will be downloaded as a CSV file on your computer. Make sure you know the location of your file (if on a Chromebook, this will be in your “Downloads” folder).</p>
<div class="figure">
<img src="https://docs.google.com/presentation/d/199w7E8ggb0nrf40A7WvVIYmNKJdVbUkcWpgnLBysZzM/export/png?id=199w7E8ggb0nrf40A7WvVIYmNKJdVbUkcWpgnLBysZzM&amp;pageid=g399e5a917a_0_56" alt="Download as CSV file" />
<p class="caption">Download as CSV file</p>
</div>
</div>
<div id="reading-csvs-into-r" class="section level3">
<h3><span class="header-section-number">1.3.2</span> Reading CSVs into R</h3>
<p>Now that you have a CSV file, let’s discuss how to get it into R! The best way to accomplish this is using the function <code>read_csv()</code> from the <code>readr</code> package. (Note, if you haven’t installed the <code>readr</code> package, you’ll have to do that first.) Inside the parenthesis of the function, write the name of the file in quotes, including the file extension (.csv). Make sure you type the exact file name. Save the imported data in a data frame called <code>df_csv</code>. Your data will now be imported into R environment. If you use the command <code>head(df_csv)</code> you will see the first several rows of your imported data frame:</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb35-1" title="1"><span class="co">## install.packages(&quot;readr&quot;)</span></a>
<a class="sourceLine" id="cb35-2" title="2"><span class="kw">library</span>(readr)</a>
<a class="sourceLine" id="cb35-3" title="3"></a>
<a class="sourceLine" id="cb35-4" title="4"><span class="co">## read CSV into R</span></a>
<a class="sourceLine" id="cb35-5" title="5">df_csv &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;sample_data - Sheet1.csv&quot;</span>)</a>
<a class="sourceLine" id="cb35-6" title="6"></a>
<a class="sourceLine" id="cb35-7" title="7"><span class="co">## look at the object</span></a>
<a class="sourceLine" id="cb35-8" title="8"><span class="kw">head</span>(df_csv)</a></code></pre></div>
<div class="figure">
<img src="https://docs.google.com/presentation/d/199w7E8ggb0nrf40A7WvVIYmNKJdVbUkcWpgnLBysZzM/export/png?id=199w7E8ggb0nrf40A7WvVIYmNKJdVbUkcWpgnLBysZzM&amp;pageid=g399e5a917a_0_16" alt="read_csv()" />
<p class="caption"><code>read_csv()</code></p>
</div>
<p>Above, you see the simplest way to import a CSV file. However, as with many functions, there are other arguments that you can set to specify how to import your specific CSV file, a few of which are listed below. However, as usual, to see all the arguments for this function, use <code>?read_csv</code> within R.</p>
<ul>
<li><code>col_names = FALSE</code> to specify that the first row does NOT contain column names.</li>
<li><code>skip = 2</code> will skip the first 2 rows. You can set the number to any number you want. Helpful if there is additional information in the first few rows of your data frame that are not actually part of the table.</li>
<li><code>n_max = 100</code> will only read in the first 100 rows. You can set the number to any number you want. Helpful if you’re not sure how big a file is and just want to see part of it</li>
</ul>
<p>By default, <code>read_csv()</code> converts blank cells to missing data (NA).</p>
<p>Finally, we introduce the function <code>read_csv</code> here and recommend that you use it, as it is the simplest and fastest way to read CSV files into R. However, we note that there <em>is</em> a function <code>read.csv()</code> which is available by default in R. You will likely see this function in others’ code, so we just want to make sure you’re aware of it.</p>
</div>
</div>
<div id="tsvs" class="section level2">
<h2><span class="header-section-number">1.4</span> TSVs</h2>
<p>Another common form of data is text files that usually come in the form of TXT or TSV file formats. Like CSVs, text files are simple, plain-text files; however, rather than columns being separated by commas, they are separated by tabs (represented by &quot; in plain-text). Like CSVs, they don’t allow text formatting (i.e. text colors in cells) and are able to be opened on many different software platforms. This makes them good candidates for storing data.</p>
<div id="reading-tsvs-into-r" class="section level3">
<h3><span class="header-section-number">1.4.1</span> Reading TSVs into R</h3>
<p>The process for reading these files into R is similar to what you’ve seen so far. We’ll again use the <code>readr</code> package, but we’ll instead use the <code>read_tsv()</code> function.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb36-1" title="1"><span class="co">## read TSV into R</span></a>
<a class="sourceLine" id="cb36-2" title="2">df_tsv &lt;-<span class="st"> </span><span class="kw">read_tsv</span>(<span class="st">&quot;sample_data - Sheet1.tsv&quot;</span>)</a>
<a class="sourceLine" id="cb36-3" title="3"></a>
<a class="sourceLine" id="cb36-4" title="4"><span class="co">## look at the object</span></a>
<a class="sourceLine" id="cb36-5" title="5"><span class="kw">head</span>(df_tsv)</a></code></pre></div>
</div>
</div>
<div id="delimited-files" class="section level2">
<h2><span class="header-section-number">1.5</span> Delimited Files</h2>
<p>Sometimes, tab-separated files are saved with the .txt file extension. TXT files can store tabular data, but they can also store simple text. Thus, while TSV is the more appropriate extension for tabular data that are tab-separated, you’ll often run into tabular data that individuals have saved as a TXT file. In these cases, you’ll want to use the more generic <code>read_delim()</code> function from <code>readr</code>.</p>
<p>Google Sheets does not allow tab-separated files to be downloaded with the .txt file extension (since .tsv is more appropriate); however, if you were to have a file “sample_data.txt” uploaded into R, you could use the following code to read it into your R Environment, where &quot; specifies that the file is tab-delimited.</p>
<div id="reading-delimited-files-into-r" class="section level3">
<h3><span class="header-section-number">1.5.1</span> Reading Delimited Files into R</h3>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb37-1" title="1"><span class="co">## read TXT into R</span></a>
<a class="sourceLine" id="cb37-2" title="2">df_txt &lt;-<span class="st"> </span><span class="kw">read_delim</span>(<span class="st">&quot;sample_data.txt&quot;</span>, <span class="dt">delim =</span> <span class="st">&quot;</span><span class="ch">\t</span><span class="st">&quot;</span>)</a>
<a class="sourceLine" id="cb37-3" title="3"></a>
<a class="sourceLine" id="cb37-4" title="4"><span class="co">## look at the object</span></a>
<a class="sourceLine" id="cb37-5" title="5"><span class="kw">head</span>(df_txt)</a></code></pre></div>
<p>This function allows you to specify how the file you’re reading is in delimited. This means, rather than R knowing by default whether or not the data are comma- or tab- separated, you’ll have to specify it within the argument <code>delim</code> in the function.</p>
<p><code>read_delim()</code> is a more generic version of <code>read_csv()</code>. What this means is that you <em>could</em> use <code>read_delim()</code> to read in a CSV file. You would just need to specify that the file was comma-delimited if you were to use that function.</p>
</div>
</div>
<div id="exporting-data-from-r" class="section level2">
<h2><span class="header-section-number">1.6</span> Exporting Data from R</h2>
<p>The last topic of this lesson is about how to export data from R. So far we learned about reading data into R. However, sometimes you would like to share <em>your</em> data with others and need to export your data from R to some format that your collaborators can see.</p>
<p>As discussed above, CSV format is a good candidate because of its simplicity and compatibility. Let’s say you have a data frame in the R environment that you would like to export as a CSV. To do so, you could use <code>write_csv()</code> from the <code>readr</code> package.</p>
<p>Since both methods are fairly similar, let’s look at the one from <code>readr</code> package. Since we’ve already created a data frame named <code>df_csv</code>, we can export it to a CSV file using the following code. After typing this command, a new CSV file called <code>my_csv_file.csv</code> will appear in the Files section.</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb38-1" title="1"><span class="kw">write_csv</span>(df_csv, <span class="dt">path =</span> <span class="st">&quot;my_csv_file.csv&quot;</span>)</a></code></pre></div>
<p>You could similar save your data as a TSV file using the function <code>write_tsv()</code> function.</p>
<p>We’ll finally note that there are default R functions <code>write.csv()</code> and <code>write.table()</code> that accomplish similar goals. You may see these in others’ code; however, we recommend sticking to the intuitive and quick <code>readr</code> functions discussed in this lesson.</p>
</div>
<div id="json" class="section level2">
<h2><span class="header-section-number">1.7</span> JSON</h2>
<p>All of the file formats we’ve discussed so far (tibbles, CSVs, Excel Spreadsheets and Google Sheets) are various ways to store what is known as tabular data, data where information is stored in rows and columns. To review, when data are stored in a tidy format, variables are stored in <strong>columns</strong> and each observation is stored in a different <strong>row</strong>. The values for each observation is stored in its respective <strong>cell</strong>. These <em>rules</em> for tabular data help define the <strong>structure</strong> of the file. Storing information in rows and columns, however, is not the only way to store data.</p>
<p>Alternatively, JSON (JavaScript Object Notation) data are <em>nested</em> and <em>hierarchical</em>. JSON is a very commonly-used text-based way to send information between a browser and a server. It is easy for humans to read and to write. JSON data adhere to certain rules in how they are structured. For simplicity, JSON format requires objects to be comprised of <strong>key-value pairs</strong>. For example, in the case of: <code>{&quot;Name&quot;: &quot;Isabela&quot;}</code>, “Name” would be a key, “Isabela” would be a value, and together they would be a key-value pair. Let’s take a look at how JSON data looks in R.This means that key-pairs can be organized into different levels (hierarchical) with some levels of information being stored <em>within</em> other levels (nested).</p>
<div class="figure">
<img src="https://docs.google.com/presentation/d/1r5T8BgmyVkHQMxXuZ8o575D1515v3RSCeciG8uyBghU/export/png?id=1r5T8BgmyVkHQMxXuZ8o575D1515v3RSCeciG8uyBghU&amp;pageid=g3d555e2b2e_0_13" alt="JSON data are hierarchical and nested" />
<p class="caption">JSON data are hierarchical and nested</p>
</div>
<p>Using a snippet of JSON data here, we see a portion of JSON data from Yelp explaining a restaurant. We’re looking at the <code>attributes</code> of this restaurant. Within <code>attributes</code>, there are four nested categories: <code>Take-out</code>, <code>Wi-Fi</code>, <code>Drive-Thru</code>, and <code>Good For</code>. In the hierarchy, attributes is at the top, while these four categories are within attributes. Within one of these attributes <code>Good For</code>, we see another level within the hierarchy. In this third level we see a number of other categories nested within <code>Good For</code>. This should give you a slightly better idea of how JSON data are structured.</p>
<p>To get a sense of what JSON data look like, take a peak at this minimal example:</p>
<p>Here, rather than reading</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb39-1" title="1"><span class="co">## generate a JSON object</span></a>
<a class="sourceLine" id="cb39-2" title="2">json &lt;-</a>
<a class="sourceLine" id="cb39-3" title="3"><span class="st">&#39;[</span></a>
<a class="sourceLine" id="cb39-4" title="4"><span class="st">  {&quot;Name&quot; : &quot;Woody&quot;, &quot;Age&quot; : 40, &quot;Occupation&quot; : &quot;Sherriff&quot;}, </span></a>
<a class="sourceLine" id="cb39-5" title="5"><span class="st">  {&quot;Name&quot; : &quot;Buzz Lightyear&quot;, &quot;Age&quot; : 34, &quot;Occupation&quot; : &quot;Space Ranger&quot;},</span></a>
<a class="sourceLine" id="cb39-6" title="6"><span class="st">  {&quot;Name&quot; : &quot;Andy&quot;, &quot;Occupation&quot; : &quot;Toy Owner&quot;}</span></a>
<a class="sourceLine" id="cb39-7" title="7"><span class="st">]&#39;</span></a>
<a class="sourceLine" id="cb39-8" title="8"></a>
<a class="sourceLine" id="cb39-9" title="9"><span class="co">## take a look</span></a>
<a class="sourceLine" id="cb39-10" title="10">json</a></code></pre></div>
<pre><code>## [1] &quot;[\n  {\&quot;Name\&quot; : \&quot;Woody\&quot;, \&quot;Age\&quot; : 40, \&quot;Occupation\&quot; : \&quot;Sherriff\&quot;}, \n  {\&quot;Name\&quot; : \&quot;Buzz Lightyear\&quot;, \&quot;Age\&quot; : 34, \&quot;Occupation\&quot; : \&quot;Space Ranger\&quot;},\n  {\&quot;Name\&quot; : \&quot;Andy\&quot;, \&quot;Occupation\&quot; : \&quot;Toy Owner\&quot;}\n]&quot;</code></pre>
<p>Here, we’ve stored information about Toy Story characters, their age, and their occupation in an object called <code>json</code></p>
<p>This format cannot, as it is, be easily worked with easily within R; however, <code>jsonlite</code> is just what to work with whenever you have data in JSON format. When using the defaults of the function <code>fromJSON()</code>, <code>jsonlite</code> will take the data from JSON array format and helpfully return a data frame.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb41-1" title="1"><span class="co">#install.packages(&quot;jsonlite&quot;)</span></a>
<a class="sourceLine" id="cb41-2" title="2"><span class="kw">library</span>(jsonlite)</a>
<a class="sourceLine" id="cb41-3" title="3"></a>
<a class="sourceLine" id="cb41-4" title="4"><span class="co">## take JSON object and covert to a data frame</span></a>
<a class="sourceLine" id="cb41-5" title="5">mydf &lt;-<span class="st"> </span><span class="kw">fromJSON</span>(json)</a>
<a class="sourceLine" id="cb41-6" title="6"></a>
<a class="sourceLine" id="cb41-7" title="7"><span class="co">## take a look</span></a>
<a class="sourceLine" id="cb41-8" title="8">mydf</a></code></pre></div>
<pre><code>##             Name Age   Occupation
## 1          Woody  40     Sherriff
## 2 Buzz Lightyear  34 Space Ranger
## 3           Andy  NA    Toy Owner</code></pre>
<div class="figure">
<img src="https://docs.google.com/presentation/d/1oK-vBO2kVl9VlzsZTwd61pqURcdKfRulmrOoxYkjlLg/export/png?id=1oK-vBO2kVl9VlzsZTwd61pqURcdKfRulmrOoxYkjlLg&amp;pageid=g3d5b27bb5d_0_219" alt="fromJSON()" />
<p class="caption"><code>fromJSON()</code></p>
</div>
<p>Data frames can also be returned to their original JSON format using the function: <code>toJSON()</code>.</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb43-1" title="1"><span class="co">## take JSON object and convert to a data frame</span></a>
<a class="sourceLine" id="cb43-2" title="2">json &lt;-<span class="st"> </span><span class="kw">toJSON</span>(mydf)</a>
<a class="sourceLine" id="cb43-3" title="3">json</a></code></pre></div>
<pre><code>## [{&quot;Name&quot;:&quot;Woody&quot;,&quot;Age&quot;:40,&quot;Occupation&quot;:&quot;Sherriff&quot;},{&quot;Name&quot;:&quot;Buzz Lightyear&quot;,&quot;Age&quot;:34,&quot;Occupation&quot;:&quot;Space Ranger&quot;},{&quot;Name&quot;:&quot;Andy&quot;,&quot;Occupation&quot;:&quot;Toy Owner&quot;}]</code></pre>
<div class="figure">
<img src="https://docs.google.com/presentation/d/1oK-vBO2kVl9VlzsZTwd61pqURcdKfRulmrOoxYkjlLg/export/png?id=1oK-vBO2kVl9VlzsZTwd61pqURcdKfRulmrOoxYkjlLg&amp;pageid=g3d5b27bb5d_0_228" alt="toJSON()" />
<p class="caption"><code>toJSON()</code></p>
</div>
<p>While this gives us an idea of how to work with JSON formatted data in R, we haven’t yet discussed how to read a JSON file into R. When you have data in the JSON format (file extension: .json), you’ll use the <code>read_json()</code> function, which helpfully looks very similar to the other <code>read_</code> functions we’ve discussed so far:</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb45-1" title="1"><span class="co"># read JSON file into R</span></a>
<a class="sourceLine" id="cb45-2" title="2"><span class="kw">read_json</span>(<span class="st">&quot;json_file.json&quot;</span>)</a>
<a class="sourceLine" id="cb45-3" title="3"></a>
<a class="sourceLine" id="cb45-4" title="4"><span class="co"># read JSON file into R and </span></a>
<a class="sourceLine" id="cb45-5" title="5"><span class="co"># simplifies nested lists into vectors and data frames</span></a>
<a class="sourceLine" id="cb45-6" title="6"><span class="kw">read_json</span>(<span class="st">&quot;json_file.json&quot;</span>, <span class="dt">simplifyVector =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p>Note in our examples here that by default, <code>read_json()</code> reads the data in while retaining the JSON format. However, if you would like to simplify the information into a data.frame, you’ll want to specify the argument, <code>simplifyVector = TRUE</code>.</p>
</div>
<div id="xml" class="section level2">
<h2><span class="header-section-number">1.8</span> XML</h2>
<p><strong>Extensible Markup Language (XML)</strong>, is another human- and machine-readable language that is used frequently by web services and APIs. However, instead of being based on key-value pairs, XML relies on <strong>nodes</strong>, <strong>tags</strong>, and <strong>elements</strong>. The author defines these <em>tags</em> to specify what information is included in each <em>element</em> of the XML document and allows for elements to be nested within one another. The <strong>nodes</strong> define the hierarchical structure of the XML (which means that XML is hierarchical and nested like JSON)!</p>
<div class="figure">
<img src="https://docs.google.com/presentation/d/1r5T8BgmyVkHQMxXuZ8o575D1515v3RSCeciG8uyBghU/export/png?id=1r5T8BgmyVkHQMxXuZ8o575D1515v3RSCeciG8uyBghU&amp;pageid=g3d555e2b2e_0_128" alt="XML format relies on nodes, tags, and elements" />
<p class="caption">XML format relies on nodes, tags, and elements</p>
</div>
<p>XML accomplishes the same goal as JSON, but it just does it in a different format. Thus, the two formats are commonly used for similar purposes – sharing information on the web; however, because the format in which they do this is different, a different R package is needed to process XML data. This packages is called <code>xml2</code>.</p>
<p>AVOCADO</p>
</div>
<div id="databases" class="section level2">
<h2><span class="header-section-number">1.9</span> Databases</h2>
<p>So far we’ve discussed reading in data that exist in a single file, like a CSV file or a Google Sheet. However, there will be many cases as where the data for your project will stored across a number of different tables that are all related to one another. In this lesson, we’ll discuss what relational data are, why you would want to store data in this way, and how to work with these types of data into R.</p>
<div id="relational-data" class="section level3">
<h3><span class="header-section-number">1.9.1</span> Relational Data</h3>
<p>Relational data can be thought of as information being stored across many tables, with each table being related to all the other tables. Each table is linked to every other table by a set of <strong>unique identifiers</strong>.</p>
<div class="figure">
<img src="https://docs.google.com/presentation/d/18NcOwo7PvEgs71mVbvCxawDFLNftxPqUpuTNnKv-C_M/export/png?id=18NcOwo7PvEgs71mVbvCxawDFLNftxPqUpuTNnKv-C_M&amp;pageid=g392f0f9db9_1_9" alt="Relational data are related by unique identifiers" />
<p class="caption">Relational data are related by unique identifiers</p>
</div>
<p>To better understand this, let’s consider a toy example. We mentioned this example in the introductory lesson in this course, and we’ll return to it now. Consider a town where you have a number of different restaurants. In one table you have information about these restaurants including, where they are located and what type of food they serve. You then have a second table where information about health and safety inspections is stored. Each inspection is a different row and the date of the inspection, the inspector, and the safety rating are stored in this table. Finally, you have a third table. This third table contains information pulled from an API, regarding the number of stars given to each restaurant, as rated by people online. Each table contains different bits of information; however, there is a common column <code>id</code> in each of the tables. This allows the information to be linked between the tables. The restaurant with the <code>id</code> “JJ29JJ” in the restaurant table would refer to the same restaurant with the <code>id</code> “JJ29JJ” in the health inspections table, and so on. The values in this <code>id</code> column are known as <code>unique identifiers</code> because they uniquely identify each restaurant. No two restaurants will have the same <code>id</code>, and the same restaurant will always have the same <code>id</code>, no matter what table you’re looking at. The fact that these tables have unique identifiers connecting each table to all the other tables makes this example <strong>relational data</strong>.</p>
<div class="figure">
<img src="https://docs.google.com/presentation/d/18NcOwo7PvEgs71mVbvCxawDFLNftxPqUpuTNnKv-C_M/export/png?id=18NcOwo7PvEgs71mVbvCxawDFLNftxPqUpuTNnKv-C_M&amp;pageid=g3a5854d1ae_0_27" alt="Unique identifiers help link entries across tables" />
<p class="caption">Unique identifiers help link entries across tables</p>
</div>
<div id="why-relational-data" class="section level4">
<h4><span class="header-section-number">1.9.1.1</span> Why relational data?</h4>
<p>Storing data in this way has a number of advantages; however, the three most important are:</p>
<ol style="list-style-type: decimal">
<li>Efficient Data Storage</li>
<li>Avoids Ambiguity</li>
<li>Privacy</li>
</ol>
<p><strong>Efficient Data Storage</strong> - By storing each bit of information in a separate table, you limit the need to repeat information. Taking our example above, imagine if we included everything in a single table. This means that for each inspection, we would copy and paste the restaurant’s address, type, and number of stars every time the facility is inspected. If a restaurant were inspected 15 times, this same information would be unnecessarily copy and pasted in each row! To avoid this, we simply separate out the information into different tables and relate them by their unique identifiers.</p>
<p><strong>Avoids Ambiguity</strong> - Take a look at the first table: “restaurant” here. You may notice there are two different restaurants named “Taco Stand.” However, looking more closely, they have a different id <em>and</em> a different address. They’re even different types of restaurants. So, despite having the same name, they actually are two different restaurants. The unique identifier makes this immediately clear!</p>
<div class="figure">
<img src="https://docs.google.com/presentation/d/18NcOwo7PvEgs71mVbvCxawDFLNftxPqUpuTNnKv-C_M/export/png?id=18NcOwo7PvEgs71mVbvCxawDFLNftxPqUpuTNnKv-C_M&amp;pageid=g3a5854d1ae_0_43" alt="Unique identifiers in relational data avoid ambiguity" />
<p class="caption">Unique identifiers in relational data avoid ambiguity</p>
</div>
<p><strong>Privacy</strong> - In using relational data, if there is ever information that is private and only some people should have access to, using this system simplifies that. You can restrict access to some of the data to ensure only those who should have access are able to access the data.</p>
</div>
</div>
<div id="relational-databases-sql" class="section level3">
<h3><span class="header-section-number">1.9.2</span> Relational Databases: <code>SQL</code></h3>
<p>Now that we have an idea of what relational data are, let’s spend a second talking about how relational data are stored. Relational data are stored in databases. The most common database is <strong>SQLite</strong>. In order to work with data in databases, there has to be a way to <strong>query</strong> or search the database for the information you’re interested in. <strong>SQL</strong> queries search through SQLite databases and return the information you ask for in your query.</p>
<p>For example, a query of the above example may look to obtain information about any restaurant that was inspected after July 1st of 2018. One would then use SQL commands to carry out this query and return the information requested.</p>
<p>While we won’t be discussing how to write SQL commands in-depth here, we <em>will</em> be discussing how to use the R package <code>RSQLite</code> to connect to an SQLite database using <code>RSQLite</code> and how to work with relational data using <code>dplyr</code> and <code>dbplyr</code></p>
</div>
<div id="connecting-to-databases-rsqlite" class="section level3">
<h3><span class="header-section-number">1.9.3</span> Connecting to Databases: <code>RSQLite</code></h3>
<p>To better understand databases and how to work with relational data, let’s just start working with data from a database! The data we’ll be using are from a database frequently used to practice working with relational data: <code>chinook.db</code>. The database includes 11 tables with data that represents a digital media store. The data includes information generally related to related to media, artists, artists’ work, and those who purchase artists’ work (customers). More information about the details of how the tables are related to one another can be found <a href="http://www.sqlitetutorial.net/sqlite-sample-database/">here</a>. For our purposes though, we’re only going to only describe two of the tables we’ll be using in our example in this lesson. We’re going to be looking at data in the <code>artists</code> and <code>albums</code> tables. <code>artists</code> and <code>albums</code> are related by the column <code>ArtistId</code>.</p>
<div class="figure">
<img src="https://docs.google.com/presentation/d/18NcOwo7PvEgs71mVbvCxawDFLNftxPqUpuTNnKv-C_M/export/png?id=18NcOwo7PvEgs71mVbvCxawDFLNftxPqUpuTNnKv-C_M&amp;pageid=g3a5854d1ae_0_60" alt="relationship between two tables in the chinook database" />
<p class="caption">relationship between two tables in the chinook database</p>
</div>
<p>Without any more details, let’s get to it! Here you’ll see the code to install and load the <code>RSQLite</code> package. You’ll then download the <code>chinook</code> sample database, connect to the database, and first obtain a list the tables in the database:</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb46-1" title="1"><span class="co">## install and load packages</span></a>
<a class="sourceLine" id="cb46-2" title="2"><span class="co">## this may take a minute or two</span></a>
<a class="sourceLine" id="cb46-3" title="3"><span class="co"># install.packages(&quot;RSQLite&quot;)</span></a>
<a class="sourceLine" id="cb46-4" title="4"><span class="co"># install.packages(&quot;httr&quot;)</span></a>
<a class="sourceLine" id="cb46-5" title="5"><span class="kw">library</span>(RSQLite)</a>
<a class="sourceLine" id="cb46-6" title="6"><span class="kw">library</span>(httr)</a>
<a class="sourceLine" id="cb46-7" title="7"></a>
<a class="sourceLine" id="cb46-8" title="8"><span class="co">## specify driver</span></a>
<a class="sourceLine" id="cb46-9" title="9">sqlite &lt;-<span class="st"> </span><span class="kw">dbDriver</span>(<span class="st">&quot;SQLite&quot;</span>)</a>
<a class="sourceLine" id="cb46-10" title="10"></a>
<a class="sourceLine" id="cb46-11" title="11"><span class="co">## download data</span></a>
<a class="sourceLine" id="cb46-12" title="12">url &lt;-<span class="st"> &quot;http://www.sqlitetutorial.net/wp-content/uploads/2018/03/chinook.zip&quot;</span></a>
<a class="sourceLine" id="cb46-13" title="13"><span class="kw">GET</span>(url, <span class="kw">write_disk</span>(tf &lt;-<span class="st"> </span><span class="kw">tempfile</span>(<span class="dt">fileext =</span> <span class="st">&quot;.zip&quot;</span>)))</a></code></pre></div>
<pre><code>## Response [https://www.sqlitetutorial.net/wp-content/uploads/2018/03/chinook.zip]
##   Date: 2019-09-23 15:27
##   Status: 200
##   Content-Type: application/zip
##   Size: 306 kB
## &lt;ON DISK&gt;  /var/folders/1s/wrtqcpxn685_zk570bnx9_rr0000gr/T//Rtmpgr6J2n/file1cd08afb810.zip</code></pre>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb48-1" title="1"><span class="kw">unzip</span>(tf)</a>
<a class="sourceLine" id="cb48-2" title="2"></a>
<a class="sourceLine" id="cb48-3" title="3"><span class="co">## Connect to Database</span></a>
<a class="sourceLine" id="cb48-4" title="4">db &lt;-<span class="st"> </span><span class="kw">dbConnect</span>(sqlite, <span class="st">&#39;chinook.db&#39;</span>)</a>
<a class="sourceLine" id="cb48-5" title="5"></a>
<a class="sourceLine" id="cb48-6" title="6"><span class="co">## list tables in database</span></a>
<a class="sourceLine" id="cb48-7" title="7"><span class="kw">dbListTables</span>(db)</a></code></pre></div>
<pre><code>##  [1] &quot;albums&quot;          &quot;artists&quot;         &quot;customers&quot;      
##  [4] &quot;employees&quot;       &quot;genres&quot;          &quot;invoice_items&quot;  
##  [7] &quot;invoices&quot;        &quot;media_types&quot;     &quot;playlist_track&quot; 
## [10] &quot;playlists&quot;       &quot;sqlite_sequence&quot; &quot;sqlite_stat1&quot;   
## [13] &quot;tracks&quot;</code></pre>
<p>The output from <code>dbListTables()</code> will include 13 tables. Among them will be the two tables we’re going to work through in our example: <code>artists</code>, and <code>albums</code>.</p>
<div class="figure">
<img src="https://docs.google.com/presentation/d/18NcOwo7PvEgs71mVbvCxawDFLNftxPqUpuTNnKv-C_M/export/png?id=18NcOwo7PvEgs71mVbvCxawDFLNftxPqUpuTNnKv-C_M&amp;pageid=g3a5854d1ae_0_286" alt="output from dbListTables(db)" />
<p class="caption">output from <code>dbListTables(db)</code></p>
</div>
<p>In this example, we’re downloading a database and working with the data locally. However, more often, when working with SQLite databases, you’ll be connecting remotely. Using the <code>RSQLite</code> package is particularly helpful in this case because it allows you to connect to and query the database from R without reading all the data in. This is helpful in the case of very large databases, where you’ll want to avoid copying all the data and will instead want to only work with the parts of the database you need.</p>
</div>
<div id="working-with-relational-data-dplyr-dbplyr" class="section level3">
<h3><span class="header-section-number">1.9.4</span> Working with Relational Data: <code>dplyr</code> &amp; <code>dbplyr</code></h3>
<p>To access these tables within R, we’ll have to install the packages <code>dbplyr</code>, which enables us to access the parts of the database we’re going to be working with. <code>dbplyr</code> allows you to use the same functions you learned when working with <code>dplyr</code>; however, it allows you to use these functions with a <em>database</em>. While <code>dbplyr</code> has to be loaded to work with databases, you likely won’t notice that you’re using it beyond that. Otherwise, you’ll just work with the files as if you were working with <code>dplyr</code> functions!</p>
<p>After installing and loading <code>dbplyr</code>, we’ll be able to use the helpful <code>tbl()</code> function to extract the two tables we’re interested in working with!</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb50-1" title="1"><span class="co">## install and load packages</span></a>
<a class="sourceLine" id="cb50-2" title="2"><span class="co"># install.packages(&quot;dbplyr&quot;)</span></a>
<a class="sourceLine" id="cb50-3" title="3"><span class="kw">library</span>(dbplyr)</a>
<a class="sourceLine" id="cb50-4" title="4"><span class="kw">library</span>(dplyr)</a>
<a class="sourceLine" id="cb50-5" title="5"></a>
<a class="sourceLine" id="cb50-6" title="6"><span class="co">## get two tables</span></a>
<a class="sourceLine" id="cb50-7" title="7">albums &lt;-<span class="st"> </span><span class="kw">tbl</span>(db, <span class="st">&quot;albums&quot;</span>)</a>
<a class="sourceLine" id="cb50-8" title="8">artists &lt;-<span class="st"> </span><span class="kw">tbl</span>(db, <span class="st">&quot;artists&quot;</span>)</a></code></pre></div>
</div>
<div id="mutating-joins" class="section level3">
<h3><span class="header-section-number">1.9.5</span> Mutating Joins</h3>
<p>Mutating joins allow you to take two different tables and combine the variables from both tables. This requires that each table have a column relating the tables to one another (i.e. a unique identifier). This unique identifier is used to match observations between the tables.</p>
<p>However, when combining tables, there are a number of different ways in which the tables can be joined. We touched on this in the Data Tidying course; however, there we only covered left joins. Now, in this lesson, we’ll cover the following types of joins:</p>
<ul>
<li>Inner Join - only keep observations found in <em>both</em> <code>x</code> <em>and</em> <code>y</code></li>
<li>Left Join - keep all observations in <code>x</code></li>
<li>Right Join - keep all observations in <code>y</code></li>
<li>Full Join - keep <em>any</em> observations in <code>x</code> <em>or</em> <code>y</code></li>
</ul>
<p>Let’s break down exactly what we mean by this using just a small toy example from the <code>artists</code> and <code>albums</code> tables from the <code>chinook</code> database. Here you see three rows from the <code>artists</code> table and four rows from the <code>albums</code> table</p>
<div class="figure">
<img src="https://docs.google.com/presentation/d/18NcOwo7PvEgs71mVbvCxawDFLNftxPqUpuTNnKv-C_M/export/png?id=18NcOwo7PvEgs71mVbvCxawDFLNftxPqUpuTNnKv-C_M&amp;pageid=g3a5854d1ae_0_88" alt="small parts of the albums and artist tables" />
<p class="caption">small parts of the <code>albums</code> and <code>artist</code> tables</p>
</div>
<div id="inner-join" class="section level4">
<h4><span class="header-section-number">1.9.5.1</span> Inner Join</h4>
<p>When talking about inner joins, we are only going to keep an observation if it is found in all of the tables we’re combining. Here, we’re combining the tables based on the <code>ArtistId</code> column. In our dummy example, there are only two artists that are found in <em>both</em> tables. These are highlighted in green and will be the rows used to join the two tables. Then, once the inner join happens, only these artists’ data will be included after the inner join.</p>
<div class="figure">
<img src="https://docs.google.com/presentation/d/18NcOwo7PvEgs71mVbvCxawDFLNftxPqUpuTNnKv-C_M/export/png?id=18NcOwo7PvEgs71mVbvCxawDFLNftxPqUpuTNnKv-C_M&amp;pageid=g3a5854d1ae_0_97" alt="inner join output will include any observation found in both tables" />
<p class="caption">inner join output will include any observation found in both tables</p>
</div>
<p>In our toy example, when doing an <code>inner_join()</code>, data from any observation found in all the tables being joined are included in the output. Here, <code>ArtistId</code>s “1” and “2” are in both the <code>artists</code> and <code>albums</code> tables. Thus, those will be the only <code>ArtistId</code>s in the output from the inner join.</p>
<p>And, since it’s a mutating join, our new table will have information from both tables! We now have <code>ArtistId</code>, <code>Name</code>, <code>AlbumId</code>, <em>and</em> <code>Title</code> in a single table! We’ve joined the two tables, based on the column <code>ArtistId</code>!</p>
<div class="figure">
<img src="https://docs.google.com/presentation/d/18NcOwo7PvEgs71mVbvCxawDFLNftxPqUpuTNnKv-C_M/export/png?id=18NcOwo7PvEgs71mVbvCxawDFLNftxPqUpuTNnKv-C_M&amp;pageid=g3a5854d1ae_0_108" alt="inner join includes observations found in both tables" />
<p class="caption">inner join includes observations found in both tables</p>
</div>
<p>Throughout this lesson we will use the coloring use see here to explain the joins, so we want to explain it explicitly here. Green cells are cells that will be used to make the merge happen and will be included in the resulting merged table. Blue cells are information that comes from the <code>artists</code> table that will be included after the merge. Red cells are pieces of information that come from the <code>albums</code> table that will be included after the merge. Finally, cells that are left white in the <code>artists</code> or <code>albums</code> table are cells that will not be included in the merge while cells that are white <em>after</em> the merge are NAs that have been added as a result of the merge.</p>
<p>Now, to run this for our tables from the database, rather than just for a few rows in our toy example, you would do the following:</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb51-1" title="1"><span class="co">## do inner join</span></a>
<a class="sourceLine" id="cb51-2" title="2">inner &lt;-<span class="st"> </span><span class="kw">inner_join</span>(artists, albums, <span class="dt">by =</span> <span class="st">&quot;ArtistId&quot;</span>)</a>
<a class="sourceLine" id="cb51-3" title="3"></a>
<a class="sourceLine" id="cb51-4" title="4"><span class="co">## look at output as a tibble</span></a>
<a class="sourceLine" id="cb51-5" title="5"><span class="kw">as_tibble</span>(inner)</a></code></pre></div>
<pre><code>## # A tibble: 347 x 4
##    ArtistId Name                 AlbumId Title                             
##       &lt;int&gt; &lt;chr&gt;                  &lt;int&gt; &lt;chr&gt;                             
##  1        1 AC/DC                      1 For Those About To Rock We Salute…
##  2        2 Accept                     2 Balls to the Wall                 
##  3        2 Accept                     3 Restless and Wild                 
##  4        1 AC/DC                      4 Let There Be Rock                 
##  5        3 Aerosmith                  5 Big Ones                          
##  6        4 Alanis Morissette          6 Jagged Little Pill                
##  7        5 Alice In Chains            7 Facelift                          
##  8        6 Antônio Carlos Jobim       8 Warner 25 Anos                    
##  9        7 Apocalyptica               9 Plays Metallica By Four Cellos    
## 10        8 Audioslave                10 Audioslave                        
## # … with 337 more rows</code></pre>
<div class="figure">
<img src="https://docs.google.com/presentation/d/18NcOwo7PvEgs71mVbvCxawDFLNftxPqUpuTNnKv-C_M/export/png?id=18NcOwo7PvEgs71mVbvCxawDFLNftxPqUpuTNnKv-C_M&amp;pageid=g3a5854d1ae_0_231" alt="inner_join() output" />
<p class="caption"><code>inner_join()</code> output</p>
</div>
</div>
<div id="left-join" class="section level4">
<h4><span class="header-section-number">1.9.5.2</span> Left Join</h4>
<p>For a left join, all rows in the first table specified will be included in the output. Any row in the second table that is <em>not</em> in the first table will not be included.</p>
<p>In our toy example this means that <code>ArtistID</code>s 1, 2, and 3 will be included in the output; however, <code>ArtistID</code> 4 will not.</p>
<div class="figure">
<img src="https://docs.google.com/presentation/d/18NcOwo7PvEgs71mVbvCxawDFLNftxPqUpuTNnKv-C_M/export/png?id=18NcOwo7PvEgs71mVbvCxawDFLNftxPqUpuTNnKv-C_M&amp;pageid=g3a5854d1ae_0_138" alt="left join will include all observations found in the first table specified" />
<p class="caption">left join will include all observations found in the first table specified</p>
</div>
<p>Thus, our output will again include all the columns from both tables combined into a single table; however, for <code>ArtistId</code> 3, there will be NAs for <code>AlbumId</code> and <code>Title</code>. NAs will be filled in for any observations in the first table specified that are missing in the second table.</p>
<div class="figure">
<img src="https://docs.google.com/presentation/d/18NcOwo7PvEgs71mVbvCxawDFLNftxPqUpuTNnKv-C_M/export/png?id=18NcOwo7PvEgs71mVbvCxawDFLNftxPqUpuTNnKv-C_M&amp;pageid=g3a5854d1ae_0_123" alt="left join will fill in NAs" />
<p class="caption">left join will fill in NAs</p>
</div>
<p>Now, to run this for our tables from the database, rather than just for a few rows in our toy example, you would do the following:</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb53-1" title="1"><span class="co">## do left join</span></a>
<a class="sourceLine" id="cb53-2" title="2">left &lt;-<span class="st"> </span><span class="kw">left_join</span>(artists, albums, <span class="dt">by =</span> <span class="st">&quot;ArtistId&quot;</span>)</a>
<a class="sourceLine" id="cb53-3" title="3"></a>
<a class="sourceLine" id="cb53-4" title="4"><span class="co">## look at output as a tibble</span></a>
<a class="sourceLine" id="cb53-5" title="5"><span class="kw">as_tibble</span>(left)</a></code></pre></div>
<pre><code>## # A tibble: 418 x 4
##    ArtistId Name                 AlbumId Title                             
##       &lt;int&gt; &lt;chr&gt;                  &lt;int&gt; &lt;chr&gt;                             
##  1        1 AC/DC                      1 For Those About To Rock We Salute…
##  2        1 AC/DC                      4 Let There Be Rock                 
##  3        2 Accept                     2 Balls to the Wall                 
##  4        2 Accept                     3 Restless and Wild                 
##  5        3 Aerosmith                  5 Big Ones                          
##  6        4 Alanis Morissette          6 Jagged Little Pill                
##  7        5 Alice In Chains            7 Facelift                          
##  8        6 Antônio Carlos Jobim       8 Warner 25 Anos                    
##  9        6 Antônio Carlos Jobim      34 Chill: Brazil (Disc 2)            
## 10        7 Apocalyptica               9 Plays Metallica By Four Cellos    
## # … with 408 more rows</code></pre>
<div class="figure">
<img src="https://docs.google.com/presentation/d/18NcOwo7PvEgs71mVbvCxawDFLNftxPqUpuTNnKv-C_M/export/png?id=18NcOwo7PvEgs71mVbvCxawDFLNftxPqUpuTNnKv-C_M&amp;pageid=g3a5854d1ae_0_237" alt="left_join() output" />
<p class="caption"><code>left_join()</code> output</p>
</div>
</div>
<div id="right-join" class="section level4">
<h4><span class="header-section-number">1.9.5.3</span> Right Join</h4>
<p>Right Join is similar to what we just discussed; however, in the output from a right join, all rows in the final table specified are included in the output. NAs will be included for any observations found in the last specified table but not in the other tables.</p>
<p>In our toy example, that means, information about <code>ArtistID</code>s 1, 2, and 4 will be included.</p>
<div class="figure">
<img src="https://docs.google.com/presentation/d/18NcOwo7PvEgs71mVbvCxawDFLNftxPqUpuTNnKv-C_M/export/png?id=18NcOwo7PvEgs71mVbvCxawDFLNftxPqUpuTNnKv-C_M&amp;pageid=g3a5854d1ae_0_150" alt="right join will include all observations found in the last table specified" />
<p class="caption">right join will include all observations found in the last table specified</p>
</div>
<p>Again, in our toy example, we see that <code>right_join()</code> combines the information across tables; however, in this case, <code>ArtistId</code> 4 is included, but <code>Name</code> is an NA, as this information was not in the <code>artists</code> table for this artist.</p>
<div class="figure">
<img src="https://docs.google.com/presentation/d/18NcOwo7PvEgs71mVbvCxawDFLNftxPqUpuTNnKv-C_M/export/png?id=18NcOwo7PvEgs71mVbvCxawDFLNftxPqUpuTNnKv-C_M&amp;pageid=g3a5854d1ae_0_160" alt="right join will fill in NAs" />
<p class="caption">right join will fill in NAs</p>
</div>
<p>Now, to run this for our tables from the database, you would have to do something <em>slightly</em> different than what you saw above. Note in the code below that we have to change teh class of the tables from the database into tibbles before doing the join. This is because SQL does not currently support right or full joins, but <code>dplyr</code> does. Thus, we first have to be sure the data are a class that <code>dplyr</code> can work with using <code>as_tibble()</code>. Other than that, the code below is similar to what you’ve seen already:</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb55-1" title="1"><span class="co">## do right join</span></a>
<a class="sourceLine" id="cb55-2" title="2">right &lt;-<span class="st"> </span><span class="kw">right_join</span>(<span class="kw">as_tibble</span>(artists), <span class="kw">as_tibble</span>(albums), <span class="dt">by =</span> <span class="st">&quot;ArtistId&quot;</span>)</a>
<a class="sourceLine" id="cb55-3" title="3"></a>
<a class="sourceLine" id="cb55-4" title="4"><span class="co">## look at output as a tibble</span></a>
<a class="sourceLine" id="cb55-5" title="5"><span class="kw">as_tibble</span>(right)</a></code></pre></div>
<pre><code>## # A tibble: 347 x 4
##    ArtistId Name                 AlbumId Title                             
##       &lt;int&gt; &lt;chr&gt;                  &lt;int&gt; &lt;chr&gt;                             
##  1        1 AC/DC                      1 For Those About To Rock We Salute…
##  2        2 Accept                     2 Balls to the Wall                 
##  3        2 Accept                     3 Restless and Wild                 
##  4        1 AC/DC                      4 Let There Be Rock                 
##  5        3 Aerosmith                  5 Big Ones                          
##  6        4 Alanis Morissette          6 Jagged Little Pill                
##  7        5 Alice In Chains            7 Facelift                          
##  8        6 Antônio Carlos Jobim       8 Warner 25 Anos                    
##  9        7 Apocalyptica               9 Plays Metallica By Four Cellos    
## 10        8 Audioslave                10 Audioslave                        
## # … with 337 more rows</code></pre>
<div class="figure">
<img src="https://docs.google.com/presentation/d/18NcOwo7PvEgs71mVbvCxawDFLNftxPqUpuTNnKv-C_M/export/png?id=18NcOwo7PvEgs71mVbvCxawDFLNftxPqUpuTNnKv-C_M&amp;pageid=g3a5854d1ae_0_245" alt="right_join() output" />
<p class="caption"><code>right_join()</code> output</p>
</div>
<p>While the output may look similar to the output from <code>left_join()</code>, you’ll note that there are a different number of rows due to how the join was done. The fact that 347 rows are present with the right join and 418 were present after the left join suggests that there are artists in the artists table without albums in the albums table.</p>
</div>
<div id="full-join" class="section level4">
<h4><span class="header-section-number">1.9.5.4</span> Full Join</h4>
<p>Finally, a full join will take every observation from every table and include it in the output.</p>
<div class="figure">
<img src="https://docs.google.com/presentation/d/18NcOwo7PvEgs71mVbvCxawDFLNftxPqUpuTNnKv-C_M/export/png?id=18NcOwo7PvEgs71mVbvCxawDFLNftxPqUpuTNnKv-C_M&amp;pageid=g3a5854d1ae_0_175" alt="full join will include any observation found in either table" />
<p class="caption">full join will include any observation found in either table</p>
</div>
<p>Thus, in our toy example, this join produces five rows, including all the observations from either table. NAs are filled in when data are missing for an observation.</p>
<div class="figure">
<img src="https://docs.google.com/presentation/d/18NcOwo7PvEgs71mVbvCxawDFLNftxPqUpuTNnKv-C_M/export/png?id=18NcOwo7PvEgs71mVbvCxawDFLNftxPqUpuTNnKv-C_M&amp;pageid=g3a5854d1ae_0_185" alt="full join will fill in NAs" />
<p class="caption">full join will fill in NAs</p>
</div>
<p>As you saw in the last example, to carry out a full join, we have to again specify that the objects are tibbles before being able to carry out the join</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb57-1" title="1"><span class="co">## do right join</span></a>
<a class="sourceLine" id="cb57-2" title="2">full &lt;-<span class="st"> </span><span class="kw">full_join</span>(<span class="kw">as_tibble</span>(artists), <span class="kw">as_tibble</span>(albums), <span class="dt">by =</span> <span class="st">&quot;ArtistId&quot;</span>)</a>
<a class="sourceLine" id="cb57-3" title="3"></a>
<a class="sourceLine" id="cb57-4" title="4"><span class="co">## look at output as a tibble</span></a>
<a class="sourceLine" id="cb57-5" title="5"><span class="kw">as_tibble</span>(full)</a></code></pre></div>
<pre><code>## # A tibble: 418 x 4
##    ArtistId Name                 AlbumId Title                             
##       &lt;int&gt; &lt;chr&gt;                  &lt;int&gt; &lt;chr&gt;                             
##  1        1 AC/DC                      1 For Those About To Rock We Salute…
##  2        1 AC/DC                      4 Let There Be Rock                 
##  3        2 Accept                     2 Balls to the Wall                 
##  4        2 Accept                     3 Restless and Wild                 
##  5        3 Aerosmith                  5 Big Ones                          
##  6        4 Alanis Morissette          6 Jagged Little Pill                
##  7        5 Alice In Chains            7 Facelift                          
##  8        6 Antônio Carlos Jobim       8 Warner 25 Anos                    
##  9        6 Antônio Carlos Jobim      34 Chill: Brazil (Disc 2)            
## 10        7 Apocalyptica               9 Plays Metallica By Four Cellos    
## # … with 408 more rows</code></pre>
<div class="figure">
<img src="https://docs.google.com/presentation/d/18NcOwo7PvEgs71mVbvCxawDFLNftxPqUpuTNnKv-C_M/export/png?id=18NcOwo7PvEgs71mVbvCxawDFLNftxPqUpuTNnKv-C_M&amp;pageid=g3a5854d1ae_0_250" alt="full_join() output" />
<p class="caption"><code>full_join()</code> output</p>
</div>
</div>
<div id="mutating-joins-summary" class="section level4">
<h4><span class="header-section-number">1.9.5.5</span> Mutating Joins Summary</h4>
<p>Now that we’ve walked through a number of examples of mutating joins, cases where you’re combining information across tables, we just want to take a second to summarize the four types of joins discussed using a visual frequently used to explain the most common mutating joins where each circle represents a different table and the gray shading on the venn diagrams indicates which observations will be included after the join.</p>
<div class="figure">
<img src="https://docs.google.com/presentation/d/1tKBs1sYK4dIZeCQt4sc7o88cuPkXA3eVfZ4Xkns7k-c/export/png?id=1tKBs1sYK4dIZeCQt4sc7o88cuPkXA3eVfZ4Xkns7k-c&amp;pageid=g6112cc596f_0_28" alt="mutating joins summary" />
<p class="caption">mutating joins summary</p>
</div>
<p>To see a visual representation of this, there is a great resource on GitHub, where these joins are illustrated, so feel free to check out <a href="https://github.com/gadenbuie/tidyexplain#readme">this link</a> from <a href="https://www.garrickadenbuie.com/">Garrick Aden-Buie</a> animating joins within relational data</p>
</div>
</div>
<div id="filtering-joins" class="section level3">
<h3><span class="header-section-number">1.9.6</span> Filtering Joins</h3>
<p>While we discussed mutating joins in detail, we’re just going to mention the ability to carry out filtering joins. While mutating joins combined variables across tables, <strong>filtering joins</strong> affect the observations, not the variables. This <em>still</em> requires a unique identifier to match the observations between tables.</p>
<p>Filtering joins keep observations in one table based on the observations present in a second table. Specifically:</p>
<ul>
<li><code>semi_join(x, y)</code> : keeps all observations in <code>x</code> with a match in <code>y</code>.</li>
<li><code>anti_join(x, y)</code> : keeps observations in <code>x</code> that do <em>NOT</em> have a match in <code>y</code>.</li>
</ul>
<p>In our toy example, if the join <code>semi_join(artists, albums)</code> were run, this would keep rows of <code>artists</code> where the <code>ArtistID</code> in <code>artist</code> was also in the <code>albums</code> table.</p>
<div class="figure">
<img src="https://docs.google.com/presentation/d/18NcOwo7PvEgs71mVbvCxawDFLNftxPqUpuTNnKv-C_M/export/png?id=18NcOwo7PvEgs71mVbvCxawDFLNftxPqUpuTNnKv-C_M&amp;pageid=g3a5854d1ae_0_255" alt="semi_join() output" />
<p class="caption"><code>semi_join()</code> output</p>
</div>
<p>Alternatively, <code>anti_join(artists, albums)</code> would output the rows of <code>artists</code> whose <code>ArtistId</code> was <em>NOT</em> found in the <code>albums</code> table.</p>
<div class="figure">
<img src="https://docs.google.com/presentation/d/18NcOwo7PvEgs71mVbvCxawDFLNftxPqUpuTNnKv-C_M/export/png?id=18NcOwo7PvEgs71mVbvCxawDFLNftxPqUpuTNnKv-C_M&amp;pageid=g3a5854d1ae_0_259" alt="anti_join() output" />
<p class="caption"><code>anti_join()</code> output</p>
</div>
<p>Note that in the case of filtering joins, the number of variables in the table <em>after</em> the join does not change. While <strong>mutating joins</strong> merged the tables creating a resulting table with more columns, with <strong>filtering joins</strong> we’re simply filtering the observations in one table based on the values in a second table.</p>
</div>
<div id="how-to-connect-to-a-database-online" class="section level3">
<h3><span class="header-section-number">1.9.7</span> How to Connect to a Database Online</h3>
<p>As mentioned briefly above, most often when working with databases, you won’t be downloading the entire database. Instead, you’ll connect to a server somewhere else where the data live and query the data (search for the parts you need) from R.</p>
<p>For example, in this lesson we downloaded the entire <code>chinook</code> database, but only ended up using <code>artists</code> and <code>albums</code>. In the future, instead of downloading <em>all</em> the data, you’ll just connect to the database and work with the parts you need.</p>
<p>This will require connecting to the database with <code>host</code>, <code>user</code>, and <code>password</code>. This information will be provided by the database’s owners, but the syntax for entering this information into R to connect to the database would look something like what you see here:</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb59-1" title="1">con &lt;-<span class="st"> </span>DBI<span class="op">::</span><span class="kw">dbConnect</span>(RMySQL<span class="op">::</span><span class="kw">MySQL</span>(), </a>
<a class="sourceLine" id="cb59-2" title="2">  <span class="dt">host =</span> <span class="st">&quot;database.host.com&quot;</span>,</a>
<a class="sourceLine" id="cb59-3" title="3">  <span class="dt">user =</span> <span class="st">&quot;janeeverydaydoe&quot;</span>,</a>
<a class="sourceLine" id="cb59-4" title="4">  <span class="dt">password =</span> rstudioapi<span class="op">::</span><span class="kw">askForPassword</span>(<span class="st">&quot;database_password&quot;</span>)</a>
<a class="sourceLine" id="cb59-5" title="5">)</a></code></pre></div>
<p>While not being discussed in detail here, it’s important to know that connecting to remote databases from R is possible and that this allows you to query the database without reading <em>all</em> the data from the database into R.</p>
</div>
</div>
<div id="web-scraping" class="section level2">
<h2><span class="header-section-number">1.10</span> Web Scraping</h2>
<p>We’ve mentioned previously that there is a lot of data on the Internet, which probably comes at no surprise given the vast amount of information on the Internet. Sometimes these data are in a nice CSV format that we can quickly pull from the Internet. Sometimes, the data are spread across a web page, and it’s our job to “scrape” that information from the webpage and get it into a usable format. Knowing first that this is possible within R and second, having some idea of where to start is an important start to beginning to get data from the Internet.</p>
<p>We’ll walk through three R packages in this lesson to help get you started in getting data from the Internet. Let’s transition a little bit to talking about how to pull pieces of data from a website, when the data aren’t (yet!) in the format that we want them.</p>
<p>In the first lesson of this course, we talked about the example of wanting to start a company but not knowing exactly what people you’ll need. So, you go to the websites of a bunch of companies similar to the company you start and pull off all the names and titles of the people working there. You then compare the titles across companies and voila, you’ve got a better idea of who you’ll need at your new company.</p>
<p>You could imagine that while this information may be helpful to have, getting it manually would be a pain. Navigating to each site individually, finding the information, copying and pasting each name. That sounds awful! Thankfully, there’s a way to scrape the web from R directly!</p>
<p>This uses the helpful package <code>rvest</code>. It gets its name from the word “harvest.” The idea here is you’ll use this package to “harvest” information from websites! However, as you may imagine, this is less straightforward than pulling data that are already formatted the way you want them (as we did above), since we’ll have to do some extra work to get everything in order.</p>
<div id="rvest-basics" class="section level3">
<h3><span class="header-section-number">1.10.1</span> <code>rvest</code> basics</h3>
<p>When <code>rvest</code> is given a webpage (URL) as input, an <code>rvest</code> function reads in the HTML code from the webpage. HTML is the language websites use to display everything you see on the website. You’ve seen HTML documents before, as this is one of the formats that you can Knit to from an R Markdown (.Rmd) document! Generally, all HTML documents require each webpage to have a similar structure. This structure is specified by using different <strong>tags</strong>. For example, a header at the top of your webpage would use a specific tag. Website links would use a different tag. These different tags help to specify how the website should appear. <code>rvest</code> takes advantage of these tags to help you extract the parts of the webpage you’re most interested in. So let’s see exactly how to do that all of this with an example.</p>
<div class="figure">
<img src="https://docs.google.com/presentation/d/1oK-vBO2kVl9VlzsZTwd61pqURcdKfRulmrOoxYkjlLg/export/png?id=1oK-vBO2kVl9VlzsZTwd61pqURcdKfRulmrOoxYkjlLg&amp;pageid=g3d5b27bb5d_0_179" alt="Different tags are used to specify different parts of a website" />
<p class="caption">Different tags are used to specify different parts of a website</p>
</div>
</div>
<div id="selectorgadget" class="section level3">
<h3><span class="header-section-number">1.10.2</span> SelectorGadget</h3>
<p>To use <code>rvest</code>, there is a tool that will make your life <em>a lot</em> easier. It’s called SelectorGadget. It’s a “javascript bookmarklet.” What this means for us is that we’ll be able to go to a webpage, turn on SelectorGadget, and help figure out how to appropriately specify what components from the webpage we want to extract using <code>rvest</code>.</p>
<p>To get started using SelectorGadget, you’ll have to enable the Chrome Extension.</p>
<p>To enable SelectorGadget using Google Chrome:</p>
<ol style="list-style-type: decimal">
<li><p>Click <a href="https://chrome.google.com/webstore/detail/selectorgadget/mhjhnkcfbdhnjickkkdbjoemdmbfginb">here</a> to open up the SelectorGadget Chrome Extension</p></li>
<li><p>Click “ADD TO CHROME”</p></li>
</ol>
<div class="figure">
<img src="https://docs.google.com/presentation/d/1oK-vBO2kVl9VlzsZTwd61pqURcdKfRulmrOoxYkjlLg/export/png?id=1oK-vBO2kVl9VlzsZTwd61pqURcdKfRulmrOoxYkjlLg&amp;pageid=g3d5b27bb5d_0_9" alt="ADD TO CHROME" />
<p class="caption">ADD TO CHROME</p>
</div>
<ol start="3" style="list-style-type: decimal">
<li>Click “Add extension”</li>
</ol>
<div class="figure">
<img src="https://docs.google.com/presentation/d/1oK-vBO2kVl9VlzsZTwd61pqURcdKfRulmrOoxYkjlLg/export/png?id=1oK-vBO2kVl9VlzsZTwd61pqURcdKfRulmrOoxYkjlLg&amp;pageid=g3d5b27bb5d_0_5" alt="Add extension" />
<p class="caption">Add extension</p>
</div>
<ol start="4" style="list-style-type: decimal">
<li>SelectorGadget’s icon will now be visible to the right of the web address bar within Google Chrome. You will click on this to use SelectorGadget in the example below.</li>
</ol>
<div class="figure">
<img src="https://docs.google.com/presentation/d/1oK-vBO2kVl9VlzsZTwd61pqURcdKfRulmrOoxYkjlLg/export/png?id=1oK-vBO2kVl9VlzsZTwd61pqURcdKfRulmrOoxYkjlLg&amp;pageid=g3d5b27bb5d_0_0" alt="SelectorGadget icon" />
<p class="caption">SelectorGadget icon</p>
</div>
</div>
<div id="web-scraping-example" class="section level3">
<h3><span class="header-section-number">1.10.3</span> Web Scraping Example</h3>
<p>Similar to the example above, what if you were interested in knowing a few recommended R packages for working with data. Sure, you could go to a whole bunch of websites and Google and copy and paste each one into a Google Sheet and have the information. But, that’s not very fun!</p>
<p>Alternatively, you could write and run a few lines of code and get all the information that way! We’ll do that in the example below.</p>
<div id="using-selectorgadget" class="section level4">
<h4><span class="header-section-number">1.10.3.1</span> Using SelectorGadget</h4>
<p>To use SelectorGadget, navigate to the webpage we’re interested in scraping: <a href="http://jhudatascience.org/stable_website/webscrape.html">http://jhudatascience.org/stable_website/webscrape.html</a> and toggle SelectorGadget by clicking on the SelectorGadget icon. A menu at the bottom-right of your web page should appear.</p>
<div class="figure">
<img src="https://docs.google.com/presentation/d/1oK-vBO2kVl9VlzsZTwd61pqURcdKfRulmrOoxYkjlLg/export/png?id=1oK-vBO2kVl9VlzsZTwd61pqURcdKfRulmrOoxYkjlLg&amp;pageid=g3d5b27bb5d_0_22" alt="SelectorGadget icon on webpage of interest" />
<p class="caption">SelectorGadget icon on webpage of interest</p>
</div>
<p>Now that SelectorGadget has been toggled, as you mouse over the page, colored boxes should appear. We’ll click on the the name of the first package to start to tell SelectorGadget which component of the webpage we’re interested in.</p>
<div class="figure">
<img src="https://docs.google.com/presentation/d/1oK-vBO2kVl9VlzsZTwd61pqURcdKfRulmrOoxYkjlLg/export/png?id=1oK-vBO2kVl9VlzsZTwd61pqURcdKfRulmrOoxYkjlLg&amp;pageid=g3d5b27bb5d_0_31" alt="SelectorGadget selects strong on webpage of interest" />
<p class="caption">SelectorGadget selects <code>strong</code> on webpage of interest</p>
</div>
<p>An orange box will appear around the component of the webpage you’ve clicked. Other components of the webpage that SelectorGadget has deemed similar to what you’ve clicked will be highlighted. And, text will show up in the menu at the bottom of the page letting you know what you should use in <code>rvest</code> to specify the part of the webpage you’re most interested in extracting.</p>
<p>Here, we see with that SelectorGadget has highlighted the package names and nothing else! Perfect. That’s just what we wanted. Now we know how to specify this element in <code>rvest</code>!</p>
</div>
<div id="using-rvest" class="section level4">
<h4><span class="header-section-number">1.10.3.2</span> Using <code>rvest</code></h4>
<p>Now we’re ready to use <code>rvest</code>’s functions. We’ll use <code>read_html()</code> to read in the HTML from our webpage of interest.</p>
<p>We’ll then use <code>html_nodes()</code> to specify which parts of the webpage we want to extract. Within this function we specify “strong”, as that’s what SelectorGadget told us to specify to “harvest” the information we’re interested in.</p>
<p>Finally <code>html_text</code> extracts the text from the tag we’ve specified, giving us that list of courses we wanted to see!</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb60-1" title="1"><span class="co">## load package</span></a>
<a class="sourceLine" id="cb60-2" title="2"><span class="co"># install.packages(&quot;rvest&quot;)</span></a>
<a class="sourceLine" id="cb60-3" title="3"><span class="kw">library</span>(rvest)</a></code></pre></div>
<pre><code>## Loading required package: xml2</code></pre>
<pre><code>## 
## Attaching package: &#39;rvest&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:purrr&#39;:
## 
##     pluck</code></pre>
<pre><code>## The following object is masked from &#39;package:readr&#39;:
## 
##     guess_encoding</code></pre>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb65-1" title="1"><span class="co">## provide URL</span></a>
<a class="sourceLine" id="cb65-2" title="2">courses &lt;-<span class="st"> </span><span class="kw">read_html</span>(<span class="st">&quot;http://jhudatascience.org/stable_website/webscrape.html&quot;</span>)</a>
<a class="sourceLine" id="cb65-3" title="3"></a>
<a class="sourceLine" id="cb65-4" title="4"><span class="co">## Get Courses</span></a>
<a class="sourceLine" id="cb65-5" title="5">courses <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb65-6" title="6"><span class="st">  </span><span class="kw">html_nodes</span>(<span class="st">&quot;strong&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb65-7" title="7"><span class="st">  </span><span class="kw">html_text</span>() </a></code></pre></div>
<pre><code>## [1] &quot;rvest&quot;        &quot;httr&quot;         &quot;dbplyr&quot;       &quot;jsonlite&quot;    
## [5] &quot;googlesheets&quot;</code></pre>
<div class="figure">
<img src="https://docs.google.com/presentation/d/1oK-vBO2kVl9VlzsZTwd61pqURcdKfRulmrOoxYkjlLg/export/png?id=1oK-vBO2kVl9VlzsZTwd61pqURcdKfRulmrOoxYkjlLg&amp;pageid=g3d5b27bb5d_0_188" alt="rvest code" />
<p class="caption"><code>rvest</code> code</p>
</div>
<p>With just a few lines of code we have the information we were looking for!</p>
<div class="figure">
<img src="https://docs.google.com/presentation/d/1oK-vBO2kVl9VlzsZTwd61pqURcdKfRulmrOoxYkjlLg/export/png?id=1oK-vBO2kVl9VlzsZTwd61pqURcdKfRulmrOoxYkjlLg&amp;pageid=g3d5b27bb5d_0_36" alt="List of packages" />
<p class="caption">List of packages</p>
</div>
</div>
</div>
<div id="a-final-note-selectorgadget" class="section level3">
<h3><span class="header-section-number">1.10.4</span> A final note: SelectorGadget</h3>
<p>SelectorGadget selected what we were interested in on the first click in the example above. However, there will be times when it makes its guess and highlights more than what you want to extract. In those cases, after the initial click, click on any one of the items currently highlighted that you don’t want included in your selection. SelectorGadget will mark that part of the webpage in red and update the menu at the bottom with the appropriate text. To see an example of this, watch this short video <a href="https://vimeo.com/52055686">here</a>.</p>
</div>
</div>
<div id="apis" class="section level2">
<h2><span class="header-section-number">1.11</span> APIs</h2>
<p><strong>Application Programming Interfaces (APIs)</strong> are, in the most general sense, software that allow to different web-based applications to communicate with one another over the Internet. Modern APIs conform to a number of standards. This means that many different applications are using the same approach, so a single package in R is able to take advantage of this and communicate with many different applications, as long as the application’s API adheres to this generally agreed upon set of “rules”.</p>
<p>The R package that we’ll be using to acquire data and take advantage of this is called <code>httr</code>. This package name suggests that this is an “R” package for “HTTP”. So, we know what R is, but what about HTTP?</p>
<p>You’ve probably seeing HTTP before at the start of web addresses, (ie <a href="http://www.gmail.com" class="uri">http://www.gmail.com</a>), so you may have some intuition that HTTP has something to do with the Internet, which is absolutely correct! HTTP stands for Hypertext Transfer Protocol. In the broadest sense, HTTP transactions allow for messages to be sent between two points on the Internet. You, on your computer can request something from a web page, and the protocol (HTTP) allows you to connect with that webpage’s server, do something, and then return you whatever it is you asked for.</p>
<p>Working with a web API is similar to accessing a website in many ways. When you type a URL (ie www.google.com) into your browser, information is sent from your computer to your browser. Your browser then interprets what you’re asking for and displays the website you’ve requested. Web APIs work similarly. You <strong>request</strong> some information from the API and the API sends back a <strong>response</strong>.</p>
<p>The <code>httr</code> package will hep you carry out these types of requests within R. Let’s stop talking about it, and see an actual example!</p>
<div class="figure">
<img src="https://docs.google.com/presentation/d/1oK-vBO2kVl9VlzsZTwd61pqURcdKfRulmrOoxYkjlLg/export/png?id=1oK-vBO2kVl9VlzsZTwd61pqURcdKfRulmrOoxYkjlLg&amp;pageid=g3d5b27bb5d_0_69" alt="HTTP access via httr" />
<p class="caption">HTTP access via <code>httr</code></p>
</div>
<div id="getting-data-httr" class="section level3">
<h3><span class="header-section-number">1.11.1</span> Getting Data: <code>httr</code></h3>
<p>HTTP is based on a number of important verbs : <code>GET()</code>, <code>HEAD()</code>, <code>PATCH()</code>, <code>PUT()</code>, <code>DELETE()</code> and <code>POST()</code>. For the purposes of retrieving data from the Internet, you may be able to guess which verb will be the most important for our purposes! <code>GET()</code> will allow us to <em>fetch</em> a resource that already exists. We’ll specify a URL to tell <code>GET()</code> where to go look for what we want. While we’ll only highlight <code>GET()</code> in this lesson, for full understanding of the many other HTTP verbs and capabilities of <code>httr</code>, refer to the additional resources provided at the end of this lesson.</p>
<p><code>GET()</code> will access the API, provide the API with the necessary information to request the data we want, and retrieve some output.</p>
<div class="figure">
<img src="https://docs.google.com/presentation/d/1oK-vBO2kVl9VlzsZTwd61pqURcdKfRulmrOoxYkjlLg/export/png?id=1oK-vBO2kVl9VlzsZTwd61pqURcdKfRulmrOoxYkjlLg&amp;pageid=g3d5b27bb5d_0_90" alt="API requests are made to an API endpoint to get an API response" />
<p class="caption">API requests are made to an API endpoint to get an API response</p>
</div>
</div>
<div id="example-1-githubs-api" class="section level3">
<h3><span class="header-section-number">1.11.2</span> Example 1: GitHub’s API</h3>
<p>The example is based on a wonderful <a href="https://www.tylerclavelle.com/code/2017/randapis/">blogpost</a> from <a href="https://www.tylerclavelle.com/about/">Tyler Clavelle</a>. In this example, we’ll use will take advantage of GitHub’s API, because it’s accessible to anyone. Other APIs, while often freely-accessible, require credentials, called an <strong>API key</strong>. We’ll talk about those later, but let’s just get started using <a href="https://developer.github.com/v3/">GitHub’s API</a> now!</p>
<div id="api-endpoint" class="section level4">
<h4><span class="header-section-number">1.11.2.1</span> API Endpoint</h4>
<p>The URL you’re requesting information from is known as the <strong>API endpoint</strong>. The documentation from GitHub’s API explains what information can be obtained from their API endpoint: <a href="https://api.github.com">https://api.github.com</a>. That’s the base endpoint, but if you wanted to access a particular individual’s GitHub repositories, you would want to modify this base endpoint to: <code>https://api.github.com/users/username/repos</code>, where you would replace <code>username</code> with <em>your</em> GitHub username.</p>
</div>
<div id="api-request-get" class="section level4">
<h4><span class="header-section-number">1.11.2.2</span> API request: <code>GET()</code></h4>
<p>Now that we know what our API endpoint is, we’re ready to make our <strong>API request</strong> using <code>GET()</code>.</p>
<p>The goal of this request is to obtain information about what repositories are available in <em>your</em> GitHub account. To use the example below, you’ll want to change the username <code>janeeverydaydoe</code> to your GitHub username.</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb67-1" title="1"><span class="co">## load package</span></a>
<a class="sourceLine" id="cb67-2" title="2"><span class="kw">library</span>(httr)</a>
<a class="sourceLine" id="cb67-3" title="3"><span class="kw">library</span>(dplyr)</a>
<a class="sourceLine" id="cb67-4" title="4">    </a>
<a class="sourceLine" id="cb67-5" title="5"><span class="co">## Save GitHub username as variable</span></a>
<a class="sourceLine" id="cb67-6" title="6">username &lt;-<span class="st"> &#39;janeeverydaydoe&#39;</span></a>
<a class="sourceLine" id="cb67-7" title="7"></a>
<a class="sourceLine" id="cb67-8" title="8"><span class="co">## Save base endpoint as variable</span></a>
<a class="sourceLine" id="cb67-9" title="9">url_git &lt;-<span class="st"> &#39;https://api.github.com/&#39;</span></a>
<a class="sourceLine" id="cb67-10" title="10"></a>
<a class="sourceLine" id="cb67-11" title="11"><span class="co">## Construct API request</span></a>
<a class="sourceLine" id="cb67-12" title="12">api_response &lt;-<span class="st"> </span><span class="kw">GET</span>(<span class="dt">url =</span> <span class="kw">paste0</span>(url_git, <span class="st">&#39;users/&#39;</span>, username, <span class="st">&#39;/repos&#39;</span>))</a></code></pre></div>
<p>Note: In the code above, you see the function <code>paste0()</code>. This function concatenates (links together) each the pieces within the parentheses, where each piece is separated by a comma. This provides <code>GET()</code> with the URL we want to use as our endpoints!</p>
<div class="figure">
<img src="https://docs.google.com/presentation/d/1oK-vBO2kVl9VlzsZTwd61pqURcdKfRulmrOoxYkjlLg/export/png?id=1oK-vBO2kVl9VlzsZTwd61pqURcdKfRulmrOoxYkjlLg&amp;pageid=g3d5b27bb5d_0_54" alt="httr code to access GitHub" />
<p class="caption"><code>httr</code> code to access GitHub</p>
</div>
</div>
<div id="api-response-content" class="section level4">
<h4><span class="header-section-number">1.11.2.3</span> API response: <code>content()</code></h4>
<p>Let’s first take a look at what other variables are available within the <code>api_response</code> object:</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb68-1" title="1"><span class="co">## See variables in response</span></a>
<a class="sourceLine" id="cb68-2" title="2"><span class="kw">names</span>(api_response)</a></code></pre></div>
<pre><code>##  [1] &quot;url&quot;         &quot;status_code&quot; &quot;headers&quot;     &quot;all_headers&quot; &quot;cookies&quot;    
##  [6] &quot;content&quot;     &quot;date&quot;        &quot;times&quot;       &quot;request&quot;     &quot;handle&quot;</code></pre>
<div class="figure">
<img src="https://docs.google.com/presentation/d/1oK-vBO2kVl9VlzsZTwd61pqURcdKfRulmrOoxYkjlLg/export/png?id=1oK-vBO2kVl9VlzsZTwd61pqURcdKfRulmrOoxYkjlLg&amp;pageid=g3d5b27bb5d_0_112" alt="httr response" />
<p class="caption"><code>httr</code> response</p>
</div>
<p>While we see ten different variables within <code>api_response</code>, we should probably first make sure that the request to GitHub’s API was successful. We can do this by checking the status code of the request, where “200” means that everything worked properly:</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb70-1" title="1"><span class="co">## Check Status Code of request</span></a>
<a class="sourceLine" id="cb70-2" title="2">api_response<span class="op">$</span>status_code</a></code></pre></div>
<pre><code>## [1] 200</code></pre>
<p>But, to be honest, we aren’t really interested in just knowing the request worked. We actually want to see what information is contained on our GitHub account.</p>
<p>To do so we’ll take advantage of <code>httr</code>’s <code>content()</code> function, which as its name suggests, extracts the contents from an API request.</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb72-1" title="1"><span class="co">## Extract content from API response</span></a>
<a class="sourceLine" id="cb72-2" title="2">repo_content &lt;-<span class="st"> </span><span class="kw">content</span>(api_response)</a></code></pre></div>
<div class="figure">
<img src="https://docs.google.com/presentation/d/1oK-vBO2kVl9VlzsZTwd61pqURcdKfRulmrOoxYkjlLg/export/png?id=1oK-vBO2kVl9VlzsZTwd61pqURcdKfRulmrOoxYkjlLg&amp;pageid=g3d5b27bb5d_0_117" alt="httr status code and content()" />
<p class="caption"><code>httr</code> status code and <code>content()</code></p>
</div>
<p>You can see here that the length of <code>repo_content</code> in our case is 6 by looking at the Environment tab. This is because the GitHub account <code>janeeverydaydoe</code> had six repositories at the time of this API call. We can get some information about each repo by running the function below:</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb73-1" title="1"><span class="co">## function to get name and URL for each repo</span></a>
<a class="sourceLine" id="cb73-2" title="2"><span class="kw">lapply</span>(repo_content, <span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb73-3" title="3">  df &lt;-<span class="st"> </span><span class="kw">data_frame</span>(<span class="dt">repo =</span> x<span class="op">$</span>name,</a>
<a class="sourceLine" id="cb73-4" title="4">                   <span class="dt">address =</span> x<span class="op">$</span>html_url)}) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb73-5" title="5"><span class="st">  </span><span class="kw">bind_rows</span>()</a></code></pre></div>
<pre><code>## # A tibble: 8 x 2
##   repo                     address                                         
##   &lt;chr&gt;                    &lt;chr&gt;                                           
## 1 cbds                     https://github.com/JaneEverydayDoe/cbds         
## 2 first_project            https://github.com/JaneEverydayDoe/first_project
## 3 gcd                      https://github.com/JaneEverydayDoe/gcd          
## 4 hello-world              https://github.com/JaneEverydayDoe/hello-world  
## 5 janeeverydaydoe.github.… https://github.com/JaneEverydayDoe/janeeveryday…
## 6 my_first_project         https://github.com/JaneEverydayDoe/my_first_pro…
## 7 newproject               https://github.com/JaneEverydayDoe/newproject   
## 8 Temporary_add_to_versio… https://github.com/JaneEverydayDoe/Temporary_ad…</code></pre>
<div class="figure">
<img src="https://docs.google.com/presentation/d/1oK-vBO2kVl9VlzsZTwd61pqURcdKfRulmrOoxYkjlLg/export/png?id=1oK-vBO2kVl9VlzsZTwd61pqURcdKfRulmrOoxYkjlLg&amp;pageid=g3d5b27bb5d_0_132" alt="output from API request" />
<p class="caption">output from API request</p>
</div>
<p>Here, we’ve pulled out the name and URL of each repository in Jane Doe’s account; however, there is <em>a lot</em> more information in the <code>repo_content</code> object. To see how to extract more information, check out the rest of Tyler’s wonderful post <a href="https://tclavelle.github.io/blog/r_and_apis/">here</a>.</p>
</div>
</div>
<div id="example-2-obtaining-a-csv" class="section level3">
<h3><span class="header-section-number">1.11.3</span> Example 2: Obtaining a CSV</h3>
<p>This same approach can be used to download datasets directly from the web. The data for this example are available for download from this link: <a href="https://data.fivethirtyeight.com/">data.fivethirtyeight.com</a>, but are also hosted on GitHub <a href="https://github.com/fivethirtyeight/data">here</a>, and we will want to use the specific URL for this file: <a href="https://raw.githubusercontent.com/fivethirtyeight/data/master/steak-survey/steak-risk-survey.csv">https://raw.githubusercontent.com/fivethirtyeight/data/master/steak-survey/steak-risk-survey.csv</a> in our <code>GET()</code> request.</p>
<div class="figure">
<img src="https://docs.google.com/presentation/d/1oK-vBO2kVl9VlzsZTwd61pqURcdKfRulmrOoxYkjlLg/export/png?id=1oK-vBO2kVl9VlzsZTwd61pqURcdKfRulmrOoxYkjlLg&amp;pageid=g3d5b27bb5d_0_148" alt="steak-survey on GitHub" />
<p class="caption">steak-survey on GitHub</p>
</div>
<p>To do so, we would do the following:</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb75-1" title="1"><span class="co">## Make API request</span></a>
<a class="sourceLine" id="cb75-2" title="2">api_response &lt;-<span class="st"> </span><span class="kw">GET</span>(<span class="dt">url =</span> <span class="st">&quot;https://raw.githubusercontent.com/fivethirtyeight/data/master/steak-survey/steak-risk-survey.csv&quot;</span>)</a>
<a class="sourceLine" id="cb75-3" title="3"></a>
<a class="sourceLine" id="cb75-4" title="4"><span class="co">## Extract content from API response</span></a>
<a class="sourceLine" id="cb75-5" title="5">df_steak &lt;-<span class="st"> </span><span class="kw">content</span>(api_response, <span class="dt">type=</span><span class="st">&quot;text/csv&quot;</span>)</a></code></pre></div>
<div class="figure">
<img src="https://docs.google.com/presentation/d/1oK-vBO2kVl9VlzsZTwd61pqURcdKfRulmrOoxYkjlLg/export/png?id=1oK-vBO2kVl9VlzsZTwd61pqURcdKfRulmrOoxYkjlLg&amp;pageid=g3d5b27bb5d_0_154" alt="GET() steak-survey CSV" />
<p class="caption"><code>GET()</code> steak-survey CSV</p>
</div>
<p>Here, we again specify our url within <code>GET()</code> followed by use of the helpful <code>content()</code> function from <code>httr</code> to obtain the CSV from the <code>api_response</code> object. <code>df_steak</code> includes the data from the CSV directly from the GitHub API, without having to download the data first!</p>
</div>
<div id="read_csv-from-a-url" class="section level3">
<h3><span class="header-section-number">1.11.4</span> <code>read_csv()</code> from a URL</h3>
<p>Before going any further, we’ll note that these data are in the CSV format and that the <code>read_csv()</code> function can read CSVs directly from a URL:</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb76-1" title="1"><span class="co">#use readr to read in CSV from URL</span></a>
<a class="sourceLine" id="cb76-2" title="2">df &lt;-<span class="st"> </span><span class="kw">read_CSV</span>( <span class="st">&quot;https://raw.githubusercontent.com/fivethirtyeight/data/master/steak-survey/steak-risk-survey.csv&quot;</span>)</a></code></pre></div>
<p>While this is a simpler approach than the previous example, you’ll want to use this approach when reading CSVs from URL. However, you won’t always have data in the CSV format, so we wanted to be sure to demonstrate how to use <code>httr</code> when obtaining information from URLs using HTTP methods.</p>
</div>
<div id="api-keys" class="section level3">
<h3><span class="header-section-number">1.11.5</span> API keys</h3>
<p>Not all API’s are as “open” as GitHub’s. For example, if you ran the code for the first example above exactly as it was written (and didn’t change the GitHub username), you would have gotten information about the repos in janeeverydaydoe’s GitHub account. Because it is a fully-open API, you’re able to retrieve information about not only your GitHub account, but also other users’ public GitHub activity. This makes good sense because sharing code among public repositories is an important part of GitHub.</p>
<p>Alternatively, while Google also has an API (or rather, <em>many</em> API’s), they aren’t quite as open. This makes good sense. There is no reason I should have access to the files on someone else’s Google Drive account. Controlling whose files one can access through Google’s API is an important privacy feature.</p>
<p>In these cases, what is known as a key is required to gain access to the API. <strong>API keys</strong> are obtained from the website’s API site (ie, for Google’s APIs, you would start <a href="https://developers.google.com/apis-explorer/#p/">here</a>. Once acquired, these keys should <strong>never be shared on the Internet</strong>. There is a reason they’re required, after all. So, be sure to <strong>never push a key to GitHub or share it publicly</strong>. (If you do ever accidentally share a key on the Internet, return to the API and disable the key immediately.)</p>
<p>For example, to access the Twitter API, you would obtain your key and necessary tokens from <a href="https://developer.twitter.com/en/docs/tweets/search/overview">Twitter’s API</a> and replace the text in the <code>key</code>, <code>secret</code>, <code>token</code> and <code>token_secret</code> arguments below. This would authenticate you to use Twitter’s API to acquire information about your home timeline.</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb77-1" title="1">myapp =<span class="st"> </span><span class="kw">oauth_app</span>(<span class="st">&quot;twitter&quot;</span>,</a>
<a class="sourceLine" id="cb77-2" title="2">                   <span class="dt">key =</span> <span class="st">&quot;yourConsumerKeyHere&quot;</span>,</a>
<a class="sourceLine" id="cb77-3" title="3">                   <span class="dt">secret =</span> <span class="st">&quot;yourConsumerSecretHere&quot;</span>)</a>
<a class="sourceLine" id="cb77-4" title="4">sig =<span class="st"> </span><span class="kw">sign_oauth1.0</span>(myapp,</a>
<a class="sourceLine" id="cb77-5" title="5">                    <span class="dt">token =</span> <span class="st">&quot;yourTokenHere&quot;</span>,</a>
<a class="sourceLine" id="cb77-6" title="6">                    <span class="dt">token_secret =</span> <span class="st">&quot;yourTokenSecretHere&quot;</span>)</a>
<a class="sourceLine" id="cb77-7" title="7">homeTL =<span class="st"> </span><span class="kw">GET</span>(<span class="st">&quot;https://api.twitter.com/1.1/statuses/home_timeline.json&quot;</span>, sig)</a></code></pre></div>
</div>
</div>
<div id="foreign-formats" class="section level2">
<h2><span class="header-section-number">1.12</span> Foreign Formats</h2>
<div id="haven" class="section level3">
<h3><span class="header-section-number">1.12.1</span> <code>haven</code></h3>
<p>AVOCADO</p>
</div>
</div>
<div id="images" class="section level2">
<h2><span class="header-section-number">1.13</span> Images</h2>
<p>Only a few decades ago, analyzing a large dataset of images was not feasible for most researchers. Many didn’t even think of images as data. But, there is so much we can get from analyzing image data. Although we will not study images processing techniques in this lesson, let’s look at one example that give us an idea of how image data can be used.</p>
<p>Within Google Maps there is a Street View feature that allows panoramic views from positions along many streets in the world. One of the things you may notice if you’re looking around on Google Maps’ street view is that for many streets in the world you do not only see houses; you are also able to see cars.</p>
<div class="figure">
<img src="https://docs.google.com/presentation/d/1r5T8BgmyVkHQMxXuZ8o575D1515v3RSCeciG8uyBghU/export/png?id=1r5T8BgmyVkHQMxXuZ8o575D1515v3RSCeciG8uyBghU&amp;pageid=g392f0f9db9_0_4" alt="Google Maps street view" />
<p class="caption">Google Maps street view</p>
</div>
<p>Some 50 million images of cars from over 200 cities were used by researchers to detect the make, model, body type, and age of the cars in each neighborhood. They were able to take unstructured image data and compile a structured data set! These same researchers then pulled together a structured dataset from the Census and the 2008 elections of demographic information (such as race and income), and voting history in these same neighborhoods.</p>
<div class="figure">
<img src="https://docs.google.com/presentation/d/1r5T8BgmyVkHQMxXuZ8o575D1515v3RSCeciG8uyBghU/export/png?id=1r5T8BgmyVkHQMxXuZ8o575D1515v3RSCeciG8uyBghU&amp;pageid=g2bfdb07292_0_151" alt="Data used from Google Maps street view to predict demographics of a neighborhood" />
<p class="caption">Data used from Google Maps street view to predict demographics of a neighborhood</p>
</div>
<p>Using these two datasets (the Google Street view car image data and the demographic data), researchers used a technique known as <strong>machine learning</strong> to build an algorithm that could, from the images of cars in a neighborhood, predict the demographics (race, income, etc) and how that area is likely to vote. Comparing these two sets of data, they were able to accurately estimate income, race, education, and voting patterns at the zip code level from the Google Street view images.</p>
<div class="figure">
<img src="https://docs.google.com/presentation/d/1r5T8BgmyVkHQMxXuZ8o575D1515v3RSCeciG8uyBghU/export/png?id=1r5T8BgmyVkHQMxXuZ8o575D1515v3RSCeciG8uyBghU&amp;pageid=g3d555e2b2e_0_0" alt="Cars in a neighborhood can predict how the area votes" />
<p class="caption">Cars in a neighborhood can predict how the area votes</p>
</div>
<div id="analyzing-images-in-r" class="section level4">
<h4><span class="header-section-number">1.13.0.1</span> Analyzing Images in R</h4>
<p>AVOCADO - this section stinks</p>
<p>Like with text, there are packages in R that will help you carry out analysis of images. In particular, <code>magick</code> is particularly helpful for advanced image processing within R, allowing you to process, edit, and manipulate images within R. Like JSON and XML, where there is more than one file format for a similar task, there are also a number of different image file formats. We touched on the pros and cons of a number of these in the Data Visualization course; however, of importance here is the fact that the <code>magick</code> package is capable of working with many different types of images, including PNG, JPEG, and TIFF. The <code>magick</code> package has a particularly helpful <a href="https://cran.r-project.org/web/packages/magick/vignettes/intro.html#drawing_and_graphics">vignette</a> where you can learn the ins and outs of working with images using <code>magick</code>’s functionality. Their documentation will discuss how to read image data into R, how to edit images, and even how to add images to your R plots!</p>
<p>[<code>magick</code> package’s example of adding an image to a plot](<img src="https://docs.google.com/presentation/d/1r5T8BgmyVkHQMxXuZ8o575D1515v3RSCeciG8uyBghU/export/png?id=1r5T8BgmyVkHQMxXuZ8o575D1515v3RSCeciG8uyBghU&amp;pageid=g3d555e2b2e_0_153" alt="Google Maps street view" /></p>
</div>
</div>
<div id="googledrive" class="section level2">
<h2><span class="header-section-number">1.14</span> <code>googledrive</code></h2>
<p>AVOCADO</p>
</div>
<div id="case-studies" class="section level2">
<h2><span class="header-section-number">1.15</span> Case Studies</h2>
<div id="case-study-1-health-expenditures" class="section level3">
<h3><span class="header-section-number">1.15.1</span> Case Study #1: Health Expenditures</h3>
<p>The data for this case study are available in <a href="https://github.com/opencasestudies/ocs-healthexpenditure/tree/master/data/KFF">CSVs hosted on GitHub</a>. CSVs from URLs can be read directly using <code>read_csv()</code> from <code>readr</code> (a core tidyverse package).</p>
<p>As a reminder, we’re ultimately interested in answering the following questions with these data:</p>
<ol style="list-style-type: decimal">
<li>Is there a relationship between healthcare coverage and healthcare spending in the United States?</li>
<li>How does the spending distribution change across geographic regions in the United States?</li>
<li>Does the relationship between healthcare coverage and healthcare spending in the United States change from 2013 to 2014?</li>
</ol>
<div id="healthcare-coverage-data" class="section level4">
<h4><span class="header-section-number">1.15.1.1</span> Healthcare Coverage Data</h4>
<p>We’ll first read the data in. Note that we have to skip the first two lines, as there are two lines in the CSV that store information about the file before we get to the actual data.</p>
<p>To see what we mean, you can always use the <code>read_lines()</code> function from <code>readr</code> to see the first few lines:</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb78-1" title="1"><span class="kw">read_lines</span>(<span class="dt">file =</span> <span class="st">&#39;https://raw.githubusercontent.com/opencasestudies/ocs-healthexpenditure/master/data/KFF/healthcare-coverage.csv&#39;</span>, <span class="dt">n_max =</span> <span class="dv">10</span>)</a></code></pre></div>
<pre><code>##  [1] &quot;\&quot;Title: Health Insurance Coverage of the Total Population | The Henry J. Kaiser Family Foundation\&quot;&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
##  [2] &quot;\&quot;Timeframe: 2013 - 2016\&quot;&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
##  [3] &quot;\&quot;Location\&quot;,\&quot;2013__Employer\&quot;,\&quot;2013__Non-Group\&quot;,\&quot;2013__Medicaid\&quot;,\&quot;2013__Medicare\&quot;,\&quot;2013__Other Public\&quot;,\&quot;2013__Uninsured\&quot;,\&quot;2013__Total\&quot;,\&quot;2014__Employer\&quot;,\&quot;2014__Non-Group\&quot;,\&quot;2014__Medicaid\&quot;,\&quot;2014__Medicare\&quot;,\&quot;2014__Other Public\&quot;,\&quot;2014__Uninsured\&quot;,\&quot;2014__Total\&quot;,\&quot;2015__Employer\&quot;,\&quot;2015__Non-Group\&quot;,\&quot;2015__Medicaid\&quot;,\&quot;2015__Medicare\&quot;,\&quot;2015__Other Public\&quot;,\&quot;2015__Uninsured\&quot;,\&quot;2015__Total\&quot;,\&quot;2016__Employer\&quot;,\&quot;2016__Non-Group\&quot;,\&quot;2016__Medicaid\&quot;,\&quot;2016__Medicare\&quot;,\&quot;2016__Other Public\&quot;,\&quot;2016__Uninsured\&quot;,\&quot;2016__Total\&quot;&quot;
##  [4] &quot;\&quot;United States\&quot;,\&quot;155696900\&quot;,\&quot;13816000\&quot;,\&quot;54919100\&quot;,\&quot;40876300\&quot;,\&quot;6295400\&quot;,\&quot;41795100\&quot;,\&quot;313401200\&quot;,\&quot;154347500\&quot;,\&quot;19313000\&quot;,\&quot;61650400\&quot;,\&quot;41896500\&quot;,\&quot;5985000\&quot;,\&quot;32967500\&quot;,\&quot;316159900\&quot;,\&quot;155965800\&quot;,\&quot;21816500\&quot;,\&quot;62384500\&quot;,\&quot;43308400\&quot;,\&quot;6422300\&quot;,\&quot;28965900\&quot;,\&quot;318868500\&quot;,\&quot;157381500\&quot;,\&quot;21884400\&quot;,\&quot;62303400\&quot;,\&quot;44550200\&quot;,\&quot;6192200\&quot;,\&quot;28051900\&quot;,\&quot;320372000\&quot;&quot;                                                                                                                                                                           
##  [5] &quot;\&quot;Alabama\&quot;,\&quot;2126500\&quot;,\&quot;174200\&quot;,\&quot;869700\&quot;,\&quot;783000\&quot;,\&quot;85600\&quot;,\&quot;724800\&quot;,\&quot;4763900\&quot;,\&quot;2202800\&quot;,\&quot;288900\&quot;,\&quot;891900\&quot;,\&quot;718400\&quot;,\&quot;143900\&quot;,\&quot;522200\&quot;,\&quot;4768000\&quot;,\&quot;2218000\&quot;,\&quot;291500\&quot;,\&quot;911400\&quot;,\&quot;719100\&quot;,\&quot;174600\&quot;,\&quot;519400\&quot;,\&quot;4833900\&quot;,\&quot;2263800\&quot;,\&quot;262400\&quot;,\&quot;997000\&quot;,\&quot;761200\&quot;,\&quot;128800\&quot;,\&quot;420800\&quot;,\&quot;4834100\&quot;&quot;                                                                                                                                                                                                                                      
##  [6] &quot;\&quot;Alaska\&quot;,\&quot;364900\&quot;,\&quot;24000\&quot;,\&quot;95000\&quot;,\&quot;55200\&quot;,\&quot;60600\&quot;,\&quot;102200\&quot;,\&quot;702000\&quot;,\&quot;345300\&quot;,\&quot;26800\&quot;,\&quot;130100\&quot;,\&quot;55300\&quot;,\&quot;37300\&quot;,\&quot;100800\&quot;,\&quot;695700\&quot;,\&quot;355700\&quot;,\&quot;22300\&quot;,\&quot;128100\&quot;,\&quot;60900\&quot;,\&quot;47700\&quot;,\&quot;90500\&quot;,\&quot;705300\&quot;,\&quot;324400\&quot;,\&quot;20300\&quot;,\&quot;145400\&quot;,\&quot;68200\&quot;,\&quot;55600\&quot;,\&quot;96900\&quot;,\&quot;710800\&quot;&quot;                                                                                                                                                                                                                                                             
##  [7] &quot;\&quot;Arizona\&quot;,\&quot;2883800\&quot;,\&quot;170800\&quot;,\&quot;1346100\&quot;,\&quot;842000\&quot;,\&quot;N/A\&quot;,\&quot;1223000\&quot;,\&quot;6603100\&quot;,\&quot;2835200\&quot;,\&quot;333500\&quot;,\&quot;1639400\&quot;,\&quot;911100\&quot;,\&quot;N/A\&quot;,\&quot;827100\&quot;,\&quot;6657200\&quot;,\&quot;2766500\&quot;,\&quot;278400\&quot;,\&quot;1711500\&quot;,\&quot;949000\&quot;,\&quot;189300\&quot;,\&quot;844800\&quot;,\&quot;6739500\&quot;,\&quot;3010700\&quot;,\&quot;377000\&quot;,\&quot;1468400\&quot;,\&quot;1028000\&quot;,\&quot;172500\&quot;,\&quot;833700\&quot;,\&quot;6890200\&quot;&quot;                                                                                                                                                                                                                                     
##  [8] &quot;\&quot;Arkansas\&quot;,\&quot;1128800\&quot;,\&quot;155600\&quot;,\&quot;600800\&quot;,\&quot;515200\&quot;,\&quot;67600\&quot;,\&quot;436800\&quot;,\&quot;2904800\&quot;,\&quot;1176500\&quot;,\&quot;231700\&quot;,\&quot;639200\&quot;,\&quot;479400\&quot;,\&quot;82000\&quot;,\&quot;287200\&quot;,\&quot;2896000\&quot;,\&quot;1293700\&quot;,\&quot;200200\&quot;,\&quot;641400\&quot;,\&quot;484500\&quot;,\&quot;63700\&quot;,\&quot;268400\&quot;,\&quot;2953000\&quot;,\&quot;1290900\&quot;,\&quot;252900\&quot;,\&quot;618600\&quot;,\&quot;490000\&quot;,\&quot;67500\&quot;,\&quot;225500\&quot;,\&quot;2945300\&quot;&quot;                                                                                                                                                                                                                                        
##  [9] &quot;\&quot;California\&quot;,\&quot;17747300\&quot;,\&quot;1986400\&quot;,\&quot;8344800\&quot;,\&quot;3828500\&quot;,\&quot;675400\&quot;,\&quot;5594100\&quot;,\&quot;38176400\&quot;,\&quot;17703700\&quot;,\&quot;2778800\&quot;,\&quot;9618800\&quot;,\&quot;4049000\&quot;,\&quot;634400\&quot;,\&quot;3916700\&quot;,\&quot;38701300\&quot;,\&quot;17718300\&quot;,\&quot;3444200\&quot;,\&quot;10138100\&quot;,\&quot;4080100\&quot;,\&quot;752700\&quot;,\&quot;2980600\&quot;,\&quot;39113900\&quot;,\&quot;18116200\&quot;,\&quot;3195400\&quot;,\&quot;9853800\&quot;,\&quot;4436000\&quot;,\&quot;556100\&quot;,\&quot;3030800\&quot;,\&quot;39188300\&quot;&quot;                                                                                                                                                                                                         
## [10] &quot;\&quot;Colorado\&quot;,\&quot;2852500\&quot;,\&quot;426300\&quot;,\&quot;697300\&quot;,\&quot;549700\&quot;,\&quot;118100\&quot;,\&quot;654000\&quot;,\&quot;5297800\&quot;,\&quot;2489400\&quot;,\&quot;397900\&quot;,\&quot;1053700\&quot;,\&quot;619500\&quot;,\&quot;214000\&quot;,\&quot;602900\&quot;,\&quot;5377400\&quot;,\&quot;2706000\&quot;,\&quot;346900\&quot;,\&quot;1036600\&quot;,\&quot;708000\&quot;,\&quot;148000\&quot;,\&quot;475700\&quot;,\&quot;5421300\&quot;,\&quot;2872600\&quot;,\&quot;370000\&quot;,\&quot;855800\&quot;,\&quot;692400\&quot;,\&quot;190100\&quot;,\&quot;528400\&quot;,\&quot;5509200\&quot;&quot;</code></pre>
<p>We’ll read in the data, starting with the third line of the file:</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb80-1" title="1">coverage &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&#39;https://raw.githubusercontent.com/opencasestudies/ocs-healthexpenditure/master/data/KFF/healthcare-coverage.csv&#39;</span>, </a>
<a class="sourceLine" id="cb80-2" title="2">                     <span class="dt">skip =</span> <span class="dv">2</span>)</a></code></pre></div>
<pre><code>## Warning: 26 parsing failures.
## row col   expected    actual                                                                                                              file
##  53  -- 29 columns 1 columns &#39;https://raw.githubusercontent.com/opencasestudies/ocs-healthexpenditure/master/data/KFF/healthcare-coverage.csv&#39;
##  54  -- 29 columns 1 columns &#39;https://raw.githubusercontent.com/opencasestudies/ocs-healthexpenditure/master/data/KFF/healthcare-coverage.csv&#39;
##  55  -- 29 columns 1 columns &#39;https://raw.githubusercontent.com/opencasestudies/ocs-healthexpenditure/master/data/KFF/healthcare-coverage.csv&#39;
##  56  -- 29 columns 1 columns &#39;https://raw.githubusercontent.com/opencasestudies/ocs-healthexpenditure/master/data/KFF/healthcare-coverage.csv&#39;
##  57  -- 29 columns 1 columns &#39;https://raw.githubusercontent.com/opencasestudies/ocs-healthexpenditure/master/data/KFF/healthcare-coverage.csv&#39;
## ... ... .......... ......... .................................................................................................................
## See problems(...) for more details.</code></pre>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb82-1" title="1">coverage</a></code></pre></div>
<pre><code>## # A tibble: 78 x 29
##    Location `2013__Employer` `2013__Non-Grou… `2013__Medicaid`
##    &lt;chr&gt;               &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;
##  1 United …        155696900         13816000         54919100
##  2 Alabama           2126500           174200           869700
##  3 Alaska             364900            24000            95000
##  4 Arizona           2883800           170800          1346100
##  5 Arkansas          1128800           155600           600800
##  6 Califor…         17747300          1986400          8344800
##  7 Colorado          2852500           426300           697300
##  8 Connect…          2030500           126800           532000
##  9 Delaware           473700            25100           192700
## 10 Distric…           324300            30400           174900
## # … with 68 more rows, and 25 more variables: `2013__Medicare` &lt;dbl&gt;,
## #   `2013__Other Public` &lt;chr&gt;, `2013__Uninsured` &lt;dbl&gt;,
## #   `2013__Total` &lt;dbl&gt;, `2014__Employer` &lt;dbl&gt;, `2014__Non-Group` &lt;dbl&gt;,
## #   `2014__Medicaid` &lt;dbl&gt;, `2014__Medicare` &lt;dbl&gt;, `2014__Other
## #   Public` &lt;chr&gt;, `2014__Uninsured` &lt;dbl&gt;, `2014__Total` &lt;dbl&gt;,
## #   `2015__Employer` &lt;dbl&gt;, `2015__Non-Group` &lt;dbl&gt;,
## #   `2015__Medicaid` &lt;dbl&gt;, `2015__Medicare` &lt;dbl&gt;, `2015__Other
## #   Public` &lt;chr&gt;, `2015__Uninsured` &lt;dbl&gt;, `2015__Total` &lt;dbl&gt;,
## #   `2016__Employer` &lt;dbl&gt;, `2016__Non-Group` &lt;dbl&gt;,
## #   `2016__Medicaid` &lt;dbl&gt;, `2016__Medicare` &lt;dbl&gt;, `2016__Other
## #   Public` &lt;chr&gt;, `2016__Uninsured` &lt;dbl&gt;, `2016__Total` &lt;dbl&gt;</code></pre>
<p>So, the first few lines of the dataset appear to store information for each state (observation) in the rows and different variables in the columns. What about the final few lines of the file?</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb84-1" title="1"><span class="kw">tail</span>(coverage, <span class="dt">n =</span> <span class="dv">30</span>)</a></code></pre></div>
<pre><code>## # A tibble: 30 x 29
##    Location `2013__Employer` `2013__Non-Grou… `2013__Medicaid`
##    &lt;chr&gt;               &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;
##  1 Washing…          3541600           309000          1026800
##  2 West Vi…           841300            42600           382500
##  3 Wiscons…          3154500           225300           907600
##  4 Wyoming            305900            19500            74200
##  5 Notes                  NA               NA               NA
##  6 The maj…               NA               NA               NA
##  7 &lt;NA&gt;                   NA               NA               NA
##  8 &quot;In thi…               NA               NA               NA
##  9 &lt;NA&gt;                   NA               NA               NA
## 10 Data ex…               NA               NA               NA
## # … with 20 more rows, and 25 more variables: `2013__Medicare` &lt;dbl&gt;,
## #   `2013__Other Public` &lt;chr&gt;, `2013__Uninsured` &lt;dbl&gt;,
## #   `2013__Total` &lt;dbl&gt;, `2014__Employer` &lt;dbl&gt;, `2014__Non-Group` &lt;dbl&gt;,
## #   `2014__Medicaid` &lt;dbl&gt;, `2014__Medicare` &lt;dbl&gt;, `2014__Other
## #   Public` &lt;chr&gt;, `2014__Uninsured` &lt;dbl&gt;, `2014__Total` &lt;dbl&gt;,
## #   `2015__Employer` &lt;dbl&gt;, `2015__Non-Group` &lt;dbl&gt;,
## #   `2015__Medicaid` &lt;dbl&gt;, `2015__Medicare` &lt;dbl&gt;, `2015__Other
## #   Public` &lt;chr&gt;, `2015__Uninsured` &lt;dbl&gt;, `2015__Total` &lt;dbl&gt;,
## #   `2016__Employer` &lt;dbl&gt;, `2016__Non-Group` &lt;dbl&gt;,
## #   `2016__Medicaid` &lt;dbl&gt;, `2016__Medicare` &lt;dbl&gt;, `2016__Other
## #   Public` &lt;chr&gt;, `2016__Uninsured` &lt;dbl&gt;, `2016__Total` &lt;dbl&gt;</code></pre>
<p>Looks like there’s a lot of missing information there at the end of the file due the “Notes” observation. Seems as though Notes were added to the file that are not the actual data. We’ll want to only include rows before the “Notes” at the end of the file, using <code>n_max</code>:</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb86-1" title="1"><span class="co">## read coverage data into R</span></a>
<a class="sourceLine" id="cb86-2" title="2">coverage &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&#39;https://raw.githubusercontent.com/opencasestudies/ocs-healthexpenditure/master/data/KFF/healthcare-coverage.csv&#39;</span>, </a>
<a class="sourceLine" id="cb86-3" title="3">                     <span class="dt">skip =</span> <span class="dv">2</span>,</a>
<a class="sourceLine" id="cb86-4" title="4">                     <span class="dt">n_max  =</span> <span class="kw">which</span>(coverage<span class="op">$</span>Location <span class="op">==</span><span class="st"> &quot;Notes&quot;</span>)<span class="op">-</span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb86-5" title="5"></a>
<a class="sourceLine" id="cb86-6" title="6"><span class="kw">tail</span>(coverage)</a></code></pre></div>
<pre><code>## # A tibble: 6 x 29
##   Location `2013__Employer` `2013__Non-Grou… `2013__Medicaid`
##   &lt;chr&gt;               &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;
## 1 Vermont            317700            26200           123400
## 2 Virginia          4661600           364800           773200
## 3 Washing…          3541600           309000          1026800
## 4 West Vi…           841300            42600           382500
## 5 Wiscons…          3154500           225300           907600
## 6 Wyoming            305900            19500            74200
## # … with 25 more variables: `2013__Medicare` &lt;dbl&gt;, `2013__Other
## #   Public` &lt;chr&gt;, `2013__Uninsured` &lt;dbl&gt;, `2013__Total` &lt;dbl&gt;,
## #   `2014__Employer` &lt;dbl&gt;, `2014__Non-Group` &lt;dbl&gt;,
## #   `2014__Medicaid` &lt;dbl&gt;, `2014__Medicare` &lt;dbl&gt;, `2014__Other
## #   Public` &lt;chr&gt;, `2014__Uninsured` &lt;dbl&gt;, `2014__Total` &lt;dbl&gt;,
## #   `2015__Employer` &lt;dbl&gt;, `2015__Non-Group` &lt;dbl&gt;,
## #   `2015__Medicaid` &lt;dbl&gt;, `2015__Medicare` &lt;dbl&gt;, `2015__Other
## #   Public` &lt;chr&gt;, `2015__Uninsured` &lt;dbl&gt;, `2015__Total` &lt;dbl&gt;,
## #   `2016__Employer` &lt;dbl&gt;, `2016__Non-Group` &lt;dbl&gt;,
## #   `2016__Medicaid` &lt;dbl&gt;, `2016__Medicare` &lt;dbl&gt;, `2016__Other
## #   Public` &lt;chr&gt;, `2016__Uninsured` &lt;dbl&gt;, `2016__Total` &lt;dbl&gt;</code></pre>
<p>Looks much better now! We can then use <code>glimpse()</code> to get a sense of what types of information are stored in our dataset.</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb88-1" title="1"><span class="kw">glimpse</span>(coverage)</a></code></pre></div>
<pre><code>## Observations: 52
## Variables: 29
## $ Location             &lt;chr&gt; &quot;United States&quot;, &quot;Alabama&quot;, &quot;Alaska&quot;, &quot;Ariz…
## $ `2013__Employer`     &lt;dbl&gt; 155696900, 2126500, 364900, 2883800, 112880…
## $ `2013__Non-Group`    &lt;dbl&gt; 13816000, 174200, 24000, 170800, 155600, 19…
## $ `2013__Medicaid`     &lt;dbl&gt; 54919100, 869700, 95000, 1346100, 600800, 8…
## $ `2013__Medicare`     &lt;dbl&gt; 40876300, 783000, 55200, 842000, 515200, 38…
## $ `2013__Other Public` &lt;chr&gt; &quot;6295400&quot;, &quot;85600&quot;, &quot;60600&quot;, &quot;N/A&quot;, &quot;67600&quot;…
## $ `2013__Uninsured`    &lt;dbl&gt; 41795100, 724800, 102200, 1223000, 436800, …
## $ `2013__Total`        &lt;dbl&gt; 313401200, 4763900, 702000, 6603100, 290480…
## $ `2014__Employer`     &lt;dbl&gt; 154347500, 2202800, 345300, 2835200, 117650…
## $ `2014__Non-Group`    &lt;dbl&gt; 19313000, 288900, 26800, 333500, 231700, 27…
## $ `2014__Medicaid`     &lt;dbl&gt; 61650400, 891900, 130100, 1639400, 639200, …
## $ `2014__Medicare`     &lt;dbl&gt; 41896500, 718400, 55300, 911100, 479400, 40…
## $ `2014__Other Public` &lt;chr&gt; &quot;5985000&quot;, &quot;143900&quot;, &quot;37300&quot;, &quot;N/A&quot;, &quot;82000…
## $ `2014__Uninsured`    &lt;dbl&gt; 32967500, 522200, 100800, 827100, 287200, 3…
## $ `2014__Total`        &lt;dbl&gt; 316159900, 4768000, 695700, 6657200, 289600…
## $ `2015__Employer`     &lt;dbl&gt; 155965800, 2218000, 355700, 2766500, 129370…
## $ `2015__Non-Group`    &lt;dbl&gt; 21816500, 291500, 22300, 278400, 200200, 34…
## $ `2015__Medicaid`     &lt;dbl&gt; 62384500, 911400, 128100, 1711500, 641400, …
## $ `2015__Medicare`     &lt;dbl&gt; 43308400, 719100, 60900, 949000, 484500, 40…
## $ `2015__Other Public` &lt;chr&gt; &quot;6422300&quot;, &quot;174600&quot;, &quot;47700&quot;, &quot;189300&quot;, &quot;63…
## $ `2015__Uninsured`    &lt;dbl&gt; 28965900, 519400, 90500, 844800, 268400, 29…
## $ `2015__Total`        &lt;dbl&gt; 318868500, 4833900, 705300, 6739500, 295300…
## $ `2016__Employer`     &lt;dbl&gt; 157381500, 2263800, 324400, 3010700, 129090…
## $ `2016__Non-Group`    &lt;dbl&gt; 21884400, 262400, 20300, 377000, 252900, 31…
## $ `2016__Medicaid`     &lt;dbl&gt; 62303400, 997000, 145400, 1468400, 618600, …
## $ `2016__Medicare`     &lt;dbl&gt; 44550200, 761200, 68200, 1028000, 490000, 4…
## $ `2016__Other Public` &lt;chr&gt; &quot;6192200&quot;, &quot;128800&quot;, &quot;55600&quot;, &quot;172500&quot;, &quot;67…
## $ `2016__Uninsured`    &lt;dbl&gt; 28051900, 420800, 96900, 833700, 225500, 30…
## $ `2016__Total`        &lt;dbl&gt; 320372000, 4834100, 710800, 6890200, 294530…</code></pre>
<p>Looks like we have a whole bunch of numberic variables, but a few that appear like they <em>should</em> be numeric, but are actually strings. We’ll keep this in mind for when we wrangle the data!</p>
</div>
<div id="healthcare-spending-data" class="section level4">
<h4><span class="header-section-number">1.15.1.2</span> Healthcare Spending Data</h4>
<p>Now, we’re ready to read in our healthcare spending data, using a similar approach as we did for the coverage data..</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb90-1" title="1"><span class="co">## read spending data into R</span></a>
<a class="sourceLine" id="cb90-2" title="2">spending &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&#39;https://raw.githubusercontent.com/opencasestudies/ocs-healthexpenditure/master/data/KFF/healthcare-spending.csv&#39;</span>, </a>
<a class="sourceLine" id="cb90-3" title="3">                     <span class="dt">skip =</span> <span class="dv">2</span>)</a></code></pre></div>
<pre><code>## Warning: 12 parsing failures.
## row col   expected    actual                                                                                                              file
##  53  -- 25 columns 1 columns &#39;https://raw.githubusercontent.com/opencasestudies/ocs-healthexpenditure/master/data/KFF/healthcare-spending.csv&#39;
##  54  -- 25 columns 1 columns &#39;https://raw.githubusercontent.com/opencasestudies/ocs-healthexpenditure/master/data/KFF/healthcare-spending.csv&#39;
##  55  -- 25 columns 1 columns &#39;https://raw.githubusercontent.com/opencasestudies/ocs-healthexpenditure/master/data/KFF/healthcare-spending.csv&#39;
##  56  -- 25 columns 1 columns &#39;https://raw.githubusercontent.com/opencasestudies/ocs-healthexpenditure/master/data/KFF/healthcare-spending.csv&#39;
##  57  -- 25 columns 1 columns &#39;https://raw.githubusercontent.com/opencasestudies/ocs-healthexpenditure/master/data/KFF/healthcare-spending.csv&#39;
## ... ... .......... ......... .................................................................................................................
## See problems(...) for more details.</code></pre>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb92-1" title="1">spending &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&#39;https://raw.githubusercontent.com/opencasestudies/ocs-healthexpenditure/master/data/KFF/healthcare-spending.csv&#39;</span>, </a>
<a class="sourceLine" id="cb92-2" title="2">                     <span class="dt">skip =</span> <span class="dv">2</span>, </a>
<a class="sourceLine" id="cb92-3" title="3">                     <span class="dt">n_max  =</span> <span class="kw">which</span>(spending<span class="op">$</span>Location <span class="op">==</span><span class="st"> &quot;Notes&quot;</span>)<span class="op">-</span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb92-4" title="4"><span class="kw">tail</span>(spending)</a></code></pre></div>
<pre><code>## # A tibble: 6 x 25
##   Location `1991__Total He… `1992__Total He… `1993__Total He…
##   &lt;chr&gt;               &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;
## 1 Vermont              1330             1421             1522
## 2 Virginia            14829            15599            16634
## 3 Washing…            12674            13859            14523
## 4 West Vi…             4672             5159             5550
## 5 Wiscons…            12694            13669            14636
## 6 Wyoming              1023             1067             1171
## # … with 21 more variables: `1994__Total Health Spending` &lt;dbl&gt;,
## #   `1995__Total Health Spending` &lt;dbl&gt;, `1996__Total Health
## #   Spending` &lt;dbl&gt;, `1997__Total Health Spending` &lt;dbl&gt;, `1998__Total
## #   Health Spending` &lt;dbl&gt;, `1999__Total Health Spending` &lt;dbl&gt;,
## #   `2000__Total Health Spending` &lt;dbl&gt;, `2001__Total Health
## #   Spending` &lt;dbl&gt;, `2002__Total Health Spending` &lt;dbl&gt;, `2003__Total
## #   Health Spending` &lt;dbl&gt;, `2004__Total Health Spending` &lt;dbl&gt;,
## #   `2005__Total Health Spending` &lt;dbl&gt;, `2006__Total Health
## #   Spending` &lt;dbl&gt;, `2007__Total Health Spending` &lt;dbl&gt;, `2008__Total
## #   Health Spending` &lt;dbl&gt;, `2009__Total Health Spending` &lt;dbl&gt;,
## #   `2010__Total Health Spending` &lt;dbl&gt;, `2011__Total Health
## #   Spending` &lt;dbl&gt;, `2012__Total Health Spending` &lt;dbl&gt;, `2013__Total
## #   Health Spending` &lt;dbl&gt;, `2014__Total Health Spending` &lt;dbl&gt;</code></pre>
</div>
<div id="states-data" class="section level4">
<h4><span class="header-section-number">1.15.1.3</span> States Data</h4>
<p>To work with these data, we’ll also want to be able to switch between full state names and two letter abbreviations. There’s data in R available to you for just this purpose!</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb94-1" title="1"><span class="kw">library</span>(datasets)</a>
<a class="sourceLine" id="cb94-2" title="2"><span class="kw">data</span>(state)</a>
<a class="sourceLine" id="cb94-3" title="3">state.name</a></code></pre></div>
<pre><code>##  [1] &quot;Alabama&quot;        &quot;Alaska&quot;         &quot;Arizona&quot;        &quot;Arkansas&quot;      
##  [5] &quot;California&quot;     &quot;Colorado&quot;       &quot;Connecticut&quot;    &quot;Delaware&quot;      
##  [9] &quot;Florida&quot;        &quot;Georgia&quot;        &quot;Hawaii&quot;         &quot;Idaho&quot;         
## [13] &quot;Illinois&quot;       &quot;Indiana&quot;        &quot;Iowa&quot;           &quot;Kansas&quot;        
## [17] &quot;Kentucky&quot;       &quot;Louisiana&quot;      &quot;Maine&quot;          &quot;Maryland&quot;      
## [21] &quot;Massachusetts&quot;  &quot;Michigan&quot;       &quot;Minnesota&quot;      &quot;Mississippi&quot;   
## [25] &quot;Missouri&quot;       &quot;Montana&quot;        &quot;Nebraska&quot;       &quot;Nevada&quot;        
## [29] &quot;New Hampshire&quot;  &quot;New Jersey&quot;     &quot;New Mexico&quot;     &quot;New York&quot;      
## [33] &quot;North Carolina&quot; &quot;North Dakota&quot;   &quot;Ohio&quot;           &quot;Oklahoma&quot;      
## [37] &quot;Oregon&quot;         &quot;Pennsylvania&quot;   &quot;Rhode Island&quot;   &quot;South Carolina&quot;
## [41] &quot;South Dakota&quot;   &quot;Tennessee&quot;      &quot;Texas&quot;          &quot;Utah&quot;          
## [45] &quot;Vermont&quot;        &quot;Virginia&quot;       &quot;Washington&quot;     &quot;West Virginia&quot; 
## [49] &quot;Wisconsin&quot;      &quot;Wyoming&quot;</code></pre>
<p>Before going any further, let’s add some information about Washington, D.C, the nation’s capital, which is not a state, but a territory.</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb96-1" title="1">state.abb &lt;-<span class="st"> </span><span class="kw">c</span>(state.abb, <span class="st">&quot;DC&quot;</span>)</a>
<a class="sourceLine" id="cb96-2" title="2">state.region &lt;-<span class="st"> </span><span class="kw">as.factor</span>(<span class="kw">c</span>(<span class="kw">as.character</span>(state.region), <span class="st">&quot;South&quot;</span>))</a>
<a class="sourceLine" id="cb96-3" title="3">state.name &lt;-<span class="st"> </span><span class="kw">c</span>(state.name, <span class="st">&quot;District of Columbia&quot;</span>)</a></code></pre></div>
</div>
</div>
<div id="case-study-2-firearms" class="section level3">
<h3><span class="header-section-number">1.15.2</span> Case Study #2: Firearms</h3>
<p>We’ve got a whole bunch of datasets that we’ll need to read in for this case study. They are from a number of different sources and are stored in different file formats. This means we’ll need to use various functions to read the data in <em>and</em> keep this in mind we we start wrangling the data.</p>
<p>As a reminder, we’re interested in the following question: At the state-level, what is the relationship between firearm legislation strength and annual rate of fatal police shootings?</p>
<div id="census-data" class="section level4">
<h4><span class="header-section-number">1.15.2.1</span> Census Data</h4>
<p>Population characteristics at the state level for 2017 are available:</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb97-1" title="1"><span class="co"># read in the census data</span></a>
<a class="sourceLine" id="cb97-2" title="2">census &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&#39;https://raw.githubusercontent.com/opencasestudies/ocs-police-shootings-firearm-legislation/master/data/sc-est2017-alldata6.csv&#39;</span>,</a>
<a class="sourceLine" id="cb97-3" title="3">                   <span class="dt">n_max =</span> <span class="dv">236900</span>)</a>
<a class="sourceLine" id="cb97-4" title="4">census</a></code></pre></div>
<pre><code>## # A tibble: 236,844 x 19
##    SUMLEV REGION DIVISION STATE NAME    SEX ORIGIN  RACE   AGE
##    &lt;chr&gt;   &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1 040         3        6 01    Alab…     0      0     1     0
##  2 040         3        6 01    Alab…     0      0     1     1
##  3 040         3        6 01    Alab…     0      0     1     2
##  4 040         3        6 01    Alab…     0      0     1     3
##  5 040         3        6 01    Alab…     0      0     1     4
##  6 040         3        6 01    Alab…     0      0     1     5
##  7 040         3        6 01    Alab…     0      0     1     6
##  8 040         3        6 01    Alab…     0      0     1     7
##  9 040         3        6 01    Alab…     0      0     1     8
## 10 040         3        6 01    Alab…     0      0     1     9
## # … with 236,834 more rows, and 10 more variables: CENSUS2010POP &lt;dbl&gt;,
## #   ESTIMATESBASE2010 &lt;dbl&gt;, POPESTIMATE2010 &lt;dbl&gt;, POPESTIMATE2011 &lt;dbl&gt;,
## #   POPESTIMATE2012 &lt;dbl&gt;, POPESTIMATE2013 &lt;dbl&gt;, POPESTIMATE2014 &lt;dbl&gt;,
## #   POPESTIMATE2015 &lt;dbl&gt;, POPESTIMATE2016 &lt;dbl&gt;, POPESTIMATE2017 &lt;dbl&gt;</code></pre>
</div>
<div id="counted-data" class="section level4">
<h4><span class="header-section-number">1.15.2.2</span> Counted Data</h4>
<p>The Counted project started to count persons killed by police in the US due to the fact “the US government has no comprehensive record of the number of people killed by law enforcement. These data can be read in from the CSV stored on GitHub, for 2015:</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb99-1" title="1"><span class="co"># read in the counted data</span></a>
<a class="sourceLine" id="cb99-2" title="2">counted15 &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;https://raw.githubusercontent.com/opencasestudies/ocs-police-shootings-firearm-legislation/master/data/the-counted-2015.csv&quot;</span>)</a></code></pre></div>
</div>
<div id="suicide-data" class="section level4">
<h4><span class="header-section-number">1.15.2.3</span> Suicide Data</h4>
<p>Information about suicide and suicide as a result of firearms can also be directly read into R from the CSVs stored on GitHub:</p>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb100-1" title="1"><span class="co"># read in suicide data</span></a>
<a class="sourceLine" id="cb100-2" title="2">suicide_all &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;https://raw.githubusercontent.com/opencasestudies/ocs-police-shootings-firearm-legislation/master/data/suicide_all.csv&quot;</span>)</a>
<a class="sourceLine" id="cb100-3" title="3">suicide_all</a></code></pre></div>
<pre><code>## # A tibble: 51 x 12
##    Sex   Race  State Ethnicity `Age Group` `First Year` `Last Year`
##    &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;     &lt;chr&gt;              &lt;dbl&gt;       &lt;dbl&gt;
##  1 Both… All … Alab… Both      All Ages            2015        2016
##  2 Both… All … Alas… Both      All Ages            2015        2016
##  3 Both… All … Ariz… Both      All Ages            2015        2016
##  4 Both… All … Arka… Both      All Ages            2015        2016
##  5 Both… All … Cali… Both      All Ages            2015        2016
##  6 Both… All … Colo… Both      All Ages            2015        2016
##  7 Both… All … Conn… Both      All Ages            2015        2016
##  8 Both… All … Dela… Both      All Ages            2015        2016
##  9 Both… All … Flor… Both      All Ages            2015        2016
## 10 Both… All … Geor… Both      All Ages            2015        2016
## # … with 41 more rows, and 5 more variables: `Cause of Death` &lt;chr&gt;,
## #   Deaths &lt;dbl&gt;, Population &lt;dbl&gt;, `Crude Rate` &lt;dbl&gt;, `Age-Adjusted
## #   Rate` &lt;chr&gt;</code></pre>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb102-1" title="1"><span class="co"># read in firearm suicide data</span></a>
<a class="sourceLine" id="cb102-2" title="2">suicide_firearm &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;https://raw.githubusercontent.com/opencasestudies/ocs-police-shootings-firearm-legislation/master/data/suicide_firearm.csv&quot;</span>)</a>
<a class="sourceLine" id="cb102-3" title="3">suicide_firearm</a></code></pre></div>
<pre><code>## # A tibble: 51 x 12
##    Sex   Race  State Ethnicity `Age Group` `First Year` `Last Year`
##    &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;     &lt;chr&gt;              &lt;dbl&gt;       &lt;dbl&gt;
##  1 Both… All … Alab… Both      All Ages            2015        2016
##  2 Both… All … Alas… Both      All Ages            2015        2016
##  3 Both… All … Ariz… Both      All Ages            2015        2016
##  4 Both… All … Arka… Both      All Ages            2015        2016
##  5 Both… All … Cali… Both      All Ages            2015        2016
##  6 Both… All … Colo… Both      All Ages            2015        2016
##  7 Both… All … Conn… Both      All Ages            2015        2016
##  8 Both… All … Dela… Both      All Ages            2015        2016
##  9 Both… All … Flor… Both      All Ages            2015        2016
## 10 Both… All … Geor… Both      All Ages            2015        2016
## # … with 41 more rows, and 5 more variables: `Cause of Death` &lt;chr&gt;,
## #   Deaths &lt;dbl&gt;, Population &lt;dbl&gt;, `Crude Rate` &lt;dbl&gt;, `Age-Adjusted
## #   Rate` &lt;chr&gt;</code></pre>
</div>
<div id="brady-data" class="section level4">
<h4><span class="header-section-number">1.15.2.4</span> Brady Data</h4>
<p>For the Brady Scores data, quantifying numerical scores for firearm legislation in each state, we’ll need the <code>httr</code> package, as these data are stored in an Excel spreadsheet. Note, we could download these files to our local computer, store them, and read this file in using <code>readxl</code>’s <code>read_excel()</code> file, <em>or</em> we can use the <code>httr</code> package to download and store the file in a temporary directory, followed by <code>read_excel</code> to read them into R. We’ll go with this second option here to demonstrate how it works.</p>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb104-1" title="1"><span class="kw">library</span>(readxl)</a>
<a class="sourceLine" id="cb104-2" title="2"><span class="kw">library</span>(httr)</a>
<a class="sourceLine" id="cb104-3" title="3"></a>
<a class="sourceLine" id="cb104-4" title="4"><span class="co"># specify URL to file</span></a>
<a class="sourceLine" id="cb104-5" title="5">url =<span class="st"> &quot;https://github.com/opencasestudies/ocs-police-shootings-firearm-legislation/blob/master/data/Brady-State-Scorecard-2015.xlsx?raw=true&quot;</span></a>
<a class="sourceLine" id="cb104-6" title="6"></a>
<a class="sourceLine" id="cb104-7" title="7"><span class="co"># Use httr&#39;s GET() and read_excel() to read in file</span></a>
<a class="sourceLine" id="cb104-8" title="8"><span class="kw">GET</span>(url, <span class="kw">write_disk</span>(tf &lt;-<span class="st"> </span><span class="kw">tempfile</span>(<span class="dt">fileext =</span> <span class="st">&quot;.xlsx&quot;</span>)))</a></code></pre></div>
<pre><code>## Response [https://raw.githubusercontent.com/opencasestudies/ocs-police-shootings-firearm-legislation/master/data/Brady-State-Scorecard-2015.xlsx]
##   Date: 2019-09-23 15:27
##   Status: 200
##   Content-Type: application/octet-stream
##   Size: 66.2 kB
## &lt;ON DISK&gt;  /var/folders/1s/wrtqcpxn685_zk570bnx9_rr0000gr/T//Rtmpgr6J2n/file1cd02e8f46a6.xlsx</code></pre>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb106-1" title="1">brady &lt;-<span class="st"> </span><span class="kw">read_excel</span>(tf, <span class="dt">sheet =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb106-2" title="2"></a>
<a class="sourceLine" id="cb106-3" title="3">brady</a></code></pre></div>
<pre><code>## # A tibble: 116 x 54
##    `States can rec… `Category Point… `Sub Category P… Points AL    AK   
##    &lt;chr&gt;                       &lt;dbl&gt;            &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;
##  1 TOTAL STATE POI…               NA               NA     NA -18   -30  
##  2 CATEGORY 1:  KE…               50               NA     NA &lt;NA&gt;  &lt;NA&gt; 
##  3 BACKGROUND CHEC…               NA               25     NA AL    AK   
##  4 Background Chec…               NA               NA     25 &lt;NA&gt;  &lt;NA&gt; 
##  5 Background Chec…               NA               NA     20 &lt;NA&gt;  &lt;NA&gt; 
##  6 Background Chec…               NA               NA      5 &lt;NA&gt;  &lt;NA&gt; 
##  7 Verifiy Legal P…               NA               NA     20 &lt;NA&gt;  &lt;NA&gt; 
##  8 TOTAL                          NA               NA     NA 0     0    
##  9 &lt;NA&gt;                           NA               NA     NA &lt;NA&gt;  &lt;NA&gt; 
## 10 OTHER LAWS TO S…               NA               12     NA AL    AK   
## # … with 106 more rows, and 48 more variables: AR &lt;chr&gt;, AZ &lt;chr&gt;,
## #   CA &lt;chr&gt;, CO &lt;chr&gt;, CT &lt;chr&gt;, DE &lt;chr&gt;, FL &lt;chr&gt;, GA &lt;chr&gt;, HI &lt;chr&gt;,
## #   ID &lt;chr&gt;, IL &lt;chr&gt;, IN &lt;chr&gt;, IA &lt;chr&gt;, KS &lt;chr&gt;, KY &lt;chr&gt;, LA &lt;chr&gt;,
## #   MA &lt;chr&gt;, MD &lt;chr&gt;, ME &lt;chr&gt;, MI &lt;chr&gt;, MN &lt;chr&gt;, MO &lt;chr&gt;, MT &lt;chr&gt;,
## #   MS &lt;chr&gt;, NC &lt;chr&gt;, ND &lt;chr&gt;, NE &lt;chr&gt;, NH &lt;chr&gt;, NJ &lt;chr&gt;, NM &lt;chr&gt;,
## #   NV &lt;chr&gt;, NY &lt;chr&gt;, OK &lt;chr&gt;, OH &lt;chr&gt;, OR &lt;chr&gt;, PA &lt;chr&gt;, RI &lt;chr&gt;,
## #   SC &lt;chr&gt;, SD &lt;chr&gt;, TN &lt;chr&gt;, TX &lt;chr&gt;, UT &lt;chr&gt;, VA &lt;chr&gt;, VT &lt;chr&gt;,
## #   WA &lt;chr&gt;, WI &lt;chr&gt;, WV &lt;chr&gt;, WY &lt;chr&gt;</code></pre>
</div>
<div id="crime-data" class="section level4">
<h4><span class="header-section-number">1.15.2.5</span> Crime Data</h4>
<p>Crime data, from the FBI’s Uniform Crime Report, are stored as an Excel file, so we’ll use a similar approach as above for these data:</p>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb108-1" title="1"><span class="co"># specify URL to file</span></a>
<a class="sourceLine" id="cb108-2" title="2">url =<span class="st"> &quot;https://github.com/opencasestudies/ocs-police-shootings-firearm-legislation/blob/master/data/table_5_crime_in_the_united_states_by_state_2015.xls?raw=true&quot;</span></a>
<a class="sourceLine" id="cb108-3" title="3"></a>
<a class="sourceLine" id="cb108-4" title="4"><span class="co"># Use httr&#39;s GET() and read_excel() to read in file</span></a>
<a class="sourceLine" id="cb108-5" title="5"><span class="kw">GET</span>(url, <span class="kw">write_disk</span>(tf &lt;-<span class="st"> </span><span class="kw">tempfile</span>(<span class="dt">fileext =</span> <span class="st">&quot;.xls&quot;</span>)))</a></code></pre></div>
<pre><code>## Response [https://raw.githubusercontent.com/opencasestudies/ocs-police-shootings-firearm-legislation/master/data/table_5_crime_in_the_united_states_by_state_2015.xls]
##   Date: 2019-09-23 15:27
##   Status: 200
##   Content-Type: application/octet-stream
##   Size: 98.3 kB
## &lt;ON DISK&gt;  /var/folders/1s/wrtqcpxn685_zk570bnx9_rr0000gr/T//Rtmpgr6J2n/file1cd03fc6f415.xls</code></pre>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb110-1" title="1">crime &lt;-<span class="st"> </span><span class="kw">read_excel</span>(tf, <span class="dt">sheet =</span> <span class="dv">1</span>, <span class="dt">skip =</span> <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb110-2" title="2"></a>
<a class="sourceLine" id="cb110-3" title="3"><span class="co"># see data</span></a>
<a class="sourceLine" id="cb110-4" title="4">crime</a></code></pre></div>
<pre><code>## # A tibble: 510 x 14
##    State Area  ...3  Population `Violent\ncrime… `Murder and \nn…
##    &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;                 &lt;dbl&gt;            &lt;dbl&gt;
##  1 ALAB… Metr… &lt;NA&gt;  3708033                  NA               NA
##  2 &lt;NA&gt;  &lt;NA&gt;  Area… 0.9709999…            18122              283
##  3 &lt;NA&gt;  &lt;NA&gt;  Esti… 1                     18500              287
##  4 &lt;NA&gt;  Citi… &lt;NA&gt;  522241                   NA               NA
##  5 &lt;NA&gt;  &lt;NA&gt;  Area… 0.9739999…             3178               32
##  6 &lt;NA&gt;  &lt;NA&gt;  Esti… 1                      3240               33
##  7 &lt;NA&gt;  Nonm… &lt;NA&gt;  628705                   NA               NA
##  8 &lt;NA&gt;  &lt;NA&gt;  Area… 0.9939999…             1205               28
##  9 &lt;NA&gt;  &lt;NA&gt;  Esti… 1                      1212               28
## 10 &lt;NA&gt;  Stat… &lt;NA&gt;  4858979               22952              348
## # … with 500 more rows, and 8 more variables:
## #   `Rape\n(revised\ndefinition)2` &lt;dbl&gt;,
## #   `Rape\n(legacy\ndefinition)3` &lt;dbl&gt;, Robbery &lt;dbl&gt;, `Aggravated
## #   \nassault` &lt;dbl&gt;, `Property \ncrime` &lt;dbl&gt;, Burglary &lt;dbl&gt;,
## #   `Larceny-\ntheft` &lt;dbl&gt;, `Motor \nvehicle \ntheft` &lt;dbl&gt;</code></pre>
<p>Note, however, there are slight differences in the code used here, relative to the Brady data. We have to use <code>skip = 3</code> to skip the first three lines of this file. <em>And</em>, this file has the extension <code>.xls</code> rather than <code>.xlsx</code>, which we specify within the <code>fileext</code> argument.</p>
</div>
<div id="land-area-data" class="section level4">
<h4><span class="header-section-number">1.15.2.6</span> Land Area Data</h4>
<p>US Census 2010 Land Area data are also stored in an excel spreadsheet&quot;</p>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb112-1" title="1"><span class="co"># specify URL to file</span></a>
<a class="sourceLine" id="cb112-2" title="2">url =<span class="st"> &quot;https://github.com/opencasestudies/ocs-police-shootings-firearm-legislation/blob/master/data/LND01.xls?raw=true&quot;</span></a>
<a class="sourceLine" id="cb112-3" title="3"></a>
<a class="sourceLine" id="cb112-4" title="4"><span class="co"># Use httr&#39;s GET() and read_excel() to read in file</span></a>
<a class="sourceLine" id="cb112-5" title="5"><span class="kw">GET</span>(url, <span class="kw">write_disk</span>(tf &lt;-<span class="st"> </span><span class="kw">tempfile</span>(<span class="dt">fileext =</span> <span class="st">&quot;.xls&quot;</span>)))</a></code></pre></div>
<pre><code>## Response [https://raw.githubusercontent.com/opencasestudies/ocs-police-shootings-firearm-legislation/master/data/LND01.xls]
##   Date: 2019-09-23 15:27
##   Status: 200
##   Content-Type: application/octet-stream
##   Size: 1.57 MB
## &lt;ON DISK&gt;  /var/folders/1s/wrtqcpxn685_zk570bnx9_rr0000gr/T//Rtmpgr6J2n/file1cd07f8a2645.xls</code></pre>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb114-1" title="1">land &lt;-<span class="st"> </span><span class="kw">read_excel</span>(tf, <span class="dt">sheet =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb114-2" title="2"></a>
<a class="sourceLine" id="cb114-3" title="3"><span class="co"># see data</span></a>
<a class="sourceLine" id="cb114-4" title="4">land</a></code></pre></div>
<pre><code>## # A tibble: 3,198 x 34
##    Areaname STCOU LND010190F LND010190D LND010190N1 LND010190N2 LND010200F
##    &lt;chr&gt;    &lt;chr&gt;      &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;            &lt;dbl&gt;
##  1 UNITED … 00000          0   3787425. 0000        0000                 0
##  2 ALABAMA  01000          0     52423. 0000        0000                 0
##  3 Autauga… 01001          0       604. 0000        0000                 0
##  4 Baldwin… 01003          0      2027. 0000        0000                 0
##  5 Barbour… 01005          0       905. 0000        0000                 0
##  6 Bibb, AL 01007          0       626. 0000        0000                 0
##  7 Blount,… 01009          0       651. 0000        0000                 0
##  8 Bullock… 01011          0       626. 0000        0000                 0
##  9 Butler,… 01013          0       778. 0000        0000                 0
## 10 Calhoun… 01015          0       612. 0000        0000                 0
## # … with 3,188 more rows, and 27 more variables: LND010200D &lt;dbl&gt;,
## #   LND010200N1 &lt;chr&gt;, LND010200N2 &lt;chr&gt;, LND110180F &lt;dbl&gt;,
## #   LND110180D &lt;dbl&gt;, LND110180N1 &lt;chr&gt;, LND110180N2 &lt;chr&gt;,
## #   LND110190F &lt;dbl&gt;, LND110190D &lt;dbl&gt;, LND110190N1 &lt;chr&gt;,
## #   LND110190N2 &lt;chr&gt;, LND110200F &lt;dbl&gt;, LND110200D &lt;dbl&gt;,
## #   LND110200N1 &lt;chr&gt;, LND110200N2 &lt;chr&gt;, LND110210F &lt;dbl&gt;,
## #   LND110210D &lt;dbl&gt;, LND110210N1 &lt;chr&gt;, LND110210N2 &lt;chr&gt;,
## #   LND210190F &lt;dbl&gt;, LND210190D &lt;dbl&gt;, LND210190N1 &lt;chr&gt;,
## #   LND210190N2 &lt;chr&gt;, LND210200F &lt;dbl&gt;, LND210200D &lt;dbl&gt;,
## #   LND210200N1 &lt;chr&gt;, LND210200N2 &lt;chr&gt;</code></pre>
</div>
<div id="unemployment-data" class="section level4">
<h4><span class="header-section-number">1.15.2.7</span> Unemployment Data</h4>
<p>This data is available online from the BLS, but there is no easy download of the table. It is also difficult to simply copy and paste; it doesn’t hold it’s table format. Thus we will want to use web scraping to most easily and accurately obtain this information using the <code>rvest</code> package.</p>
<p>As a reminder, to view the HTML of a webpage, right-click and select “View page source.”</p>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb116-1" title="1"><span class="kw">library</span>(rvest)</a>
<a class="sourceLine" id="cb116-2" title="2"></a>
<a class="sourceLine" id="cb116-3" title="3"><span class="co"># specify URL to where we&#39;ll be web scraping</span></a>
<a class="sourceLine" id="cb116-4" title="4">url &lt;-<span class="st"> </span><span class="kw">read_html</span>(<span class="st">&quot;https://www.bls.gov/lau/lastrk15.htm&quot;</span>)</a>
<a class="sourceLine" id="cb116-5" title="5"></a>
<a class="sourceLine" id="cb116-6" title="6"><span class="co"># scrape specific table desired</span></a>
<a class="sourceLine" id="cb116-7" title="7">out &lt;-<span class="st"> </span><span class="kw">html_nodes</span>(url, <span class="st">&quot;table&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb116-8" title="8"><span class="st">  </span>.[<span class="dv">2</span>] <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb116-9" title="9"><span class="st">  </span><span class="kw">html_table</span>(<span class="dt">fill =</span> <span class="ot">TRUE</span>) </a>
<a class="sourceLine" id="cb116-10" title="10"></a>
<a class="sourceLine" id="cb116-11" title="11"><span class="co"># store as a tibble</span></a>
<a class="sourceLine" id="cb116-12" title="12">unemployment &lt;-<span class="st"> </span><span class="kw">as_tibble</span>(out[[<span class="dv">1</span>]]) </a>
<a class="sourceLine" id="cb116-13" title="13"></a>
<a class="sourceLine" id="cb116-14" title="14">unemployment</a></code></pre></div>
<pre><code>## # A tibble: 54 x 3
##    State         `2015rate` Rank 
##    &lt;chr&gt;         &lt;chr&gt;      &lt;chr&gt;
##  1 United States 5.3        &quot;&quot;   
##  2 &quot;&quot;            &quot;&quot;         &quot;&quot;   
##  3 North Dakota  2.8        1    
##  4 Nebraska      3.0        2    
##  5 South Dakota  3.1        3    
##  6 New Hampshire 3.4        4    
##  7 Hawaii        3.6        5    
##  8 Utah          3.6        5    
##  9 Vermont       3.6        5    
## 10 Minnesota     3.7        8    
## # … with 44 more rows</code></pre>
<p>Then we get the values from each column of the data table. html_nodes acts as a CSS selector. The “table” class returns two tables from the webpage and we specify that we want the second table. From <code>out</code> we select the first in the list and store this as a tibble.</p>
</div>
</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>


    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
},
"search": false
});
});
</script>

</body>

</html>
